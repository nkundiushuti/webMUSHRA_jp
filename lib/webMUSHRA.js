function AudioFileLoader(t,e){this.audioContext=t,this.errorHandler=e,this.files=[]}function GenericAudioControl(t,e,i,o){this.audioContext=t,this.bufferSize=parseInt(e),this.stimuli=i,this.errorHandler=o,this.eventListeners=[],this.audioMaxPositions=[],this.audioCurrentPositions=[],this.audioStimulusIndex=null,this.audioCommand=null,this.audioCommandSwitchIndex=null}function MushraAudioControl(t,e,i,o,n,s,a,r){this.audioContext=t,this.bufferSize=parseInt(e),this.reference=i,this.conditions=o,this.errorHandler=n,this.createAnchor35=s,this.createAnchor70=a,this.lowAnchor=null,this.midAnchor=null,this.audioPlaying=!1,this.audioCurrentPosition=0,this.audioSampleRate=null,this.audioLoopStart=0,this.audioLoopEnd=null,this.audioMaxPosition=null,this.audioStimulus=null,this.audioLoopingActive=!0,this.audioFadingActive=0,this.audioFadingIn=null,this.audioFadingCurrentPosition=0,this.audioFadingMaxPosition=parseInt(.005*audioContext.sampleRate),this.audioMinimumLoopDuration=parseInt(.5*audioContext.sampleRate),this.audioVolume=1,this.audioIsReferencePlaying=null,this.audioCurrentPositionRequest=null,this.audioFadingActiveRequest=null,this.eventListeners=[],this.conditions[this.conditions.length]=this.reference,this.createAnchor35&&(this.conditions[this.conditions.length]=this.createLowerAnchor35(this.reference.getAudioBuffer())),this.createAnchor70&&(this.conditions[this.conditions.length]=this.createLowerAnchor70(this.reference.getAudioBuffer())),!1!==r&&shuffle(this.conditions);r=Math.min.apply(null,this.conditions.map(function(t){return t.getAudioBuffer().length})),r=Math.min(r,this.reference.getAudioBuffer().length);this.audioLoopEnd=r,this.audioMaxPosition=r,this.audioSampleRate=this.reference.getAudioBuffer().sampleRate}function DataSender(t,e,i){this.target=t.remoteService,this.pageManager=e,this.errorHandler=i}function ErrorHandler(){this.errors=[]}function PageManager(t,e,i,o,n){this.pages=[],this.pagesIndex=-1,this.parentElementId=e,this.varName=t,this.callbacksPageEventChanged=[],this.localizer=i,this.errorHandler=o,this.stopOnErrors=n}function PageTemplateRenderer(t,e,i){this.progressbarId=null,this.headerId=null,this.navigationId=0,this.showButtonPreviousPage=e,this.language=i,this.pageManager=t,this.lockNextButtonQueued=!1,this.callbacksEventRefreshed=[]}function BS1116AudioControlInputController(t,e){Object.getPrototypeOf(BS1116AudioControlInputController.prototype).constructor.call(this,t,e)}function FilePlayerController(t){Object.getPrototypeOf(FilePlayerController.prototype).constructor.call(this,t)}function InputController(t,e){this.audioControl=t,this.looping=e}function MushraAudioControlInputController(t,e){Object.getPrototypeOf(MushraAudioControlInputController.prototype).constructor.call(this,t,e)}function BS1116Rating(){this.reference=null,this.nonReference=null,this.referenceScore=null,this.nonReferenceScore=null,this.comment=null,this.time=null}function LikertResponse(){this.stimulus=null,this.stimulusRating=null,this.time=null}function MUSHRARating(){this.stimulus=null,this.score=null,this.comment=null,this.time=null}function PairedComparisonChoice(){this.reference=null,this.nonReference=null,this.answer=null,this.comment=null,this.time=null}function Session(){this.testId=null,this.participant={},this.trials=[]}function SpatialASWRating(){this.position_outerRight=null,this.position_innerRight=null,this.position_outerLeft=null,this.position_innerLeft=null,this.stimulus=null,this.name=null}function SpatialHWDRating(){this.position_outerRight=null,this.position_innerRight=null,this.position_outerLeft=null,this.position_innerLeft=null,this.stimulus=null,this.name=null,this.height=null,this.depth=null}function SpatialLEVRating(){this.position_center=null,this.position_height=null,this.position_width1=null,this.position_width2=null,this.stimulus=null,this.name=null}function SpatialLocalizationRating(){this.position=null,this.stimulus=null,this.name=null}function Stimulus(t,e){this.id=t,this.filepath=e,this.audioBuffer=null}function Trial(){this.id="",this.type=null,this.responses=[]}function FilePlayer(t,e,i,o,n,s,a){this.audioContext=t,this.bufferSize=e,this.stimuli=i,this.errorHandler=o,this.language=n,this.localizer=s,this.genericAudioControl=new GenericAudioControl(this.audioContext,this.bufferSize,this.stimuli,this.errorHandler),this.progressBars=[],this.hideProgressBar=a,this.genericAudioControl.addEventListener(function(t){"processUpdate"==t.name?$("#FilePlayer_progressbar_"+t.index).progressbar("option","value",t.currentSample/(t.numSamples-1)*100):"ended"==t.name&&$("#playPause"+t.index).text(this.localizer.getFragment(this.language,"playButton"))}.bind(this)),this.hooks=[]}function LikertScale(t,e,i,o){this.responseConfig=t,this.prefix=e,this.initDisabled=i,this.callback=o,this.group=null,this.elements=null}function Localizer(){this.nlsFragments=new Object}function MushraValidator(t){this.errorHandler=t}function shuffle(t){for(var e=t.length-1;0<e;e--){var i=Math.floor(Math.random()*(e+1)),o=t[e];t[e]=t[i],t[i]=o}}function WaveformVisualizer(t,e,i,o,n,s){this.variableName=t,this.parent=e,this.stimulus=i,this.showWaveform=o,this.enableLooping=n,this.mushraAudioControl=s,this.table=$('<table id="waveTable"></table>'),this.slider=$('<div id="slider"></div'),this.parentWavesurfer=$('<div id="parentWavesurfer"></div'),this.parentSlider=$("<div></div>"),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.enableLooping?this.parent.append(this.table):this.parent.append(this.parentWavesurfer);var a=i.getAudioBuffer(),r=a.numberOfChannels;this.avgOriginalSamples=new Float32Array(a.length);for(var l=0;l<a.length;++l){for(var h=0,p=0;p<r;p++)h+=a.getChannelData(p)[l];var u=h*(1/r);this.avgOriginalSamples[l]=u}this.resampledSamples=this.avgOriginalSamples,this.currentPosition=0,this.leftRegionPosition=0,this.rightRegionPosition=this.resampledSamples.length,this.numberEventListener=this.mushraAudioControl.addEventListener(function(t){var e,i;"processUpdate"==t.name&&this.setCurrentPosition(t.currentSample),this.enableLooping&&("loopStartChanged"!=t.name&&"loopChanged"!=t.name||(e=t.start,parseFloat(this.slider.get(0).noUiSlider.get()[0])!=t.start&&this.slider.get(0).noUiSlider.set([e,this.slider.get(0).noUiSlider.get()[1]]),i=this.leftRegionPosition,this.setLeftRegionPosition(e),i!=this.leftRegionPosition&&this.refresh()),"loopEndChanged"!=t.name&&"loopChanged"!=t.name||(i=t.end,parseFloat(this.slider.get(0).noUiSlider.get()[1])!=t.end&&this.slider.get(0).noUiSlider.set([this.slider.get(0).noUiSlider.get()[0],i]),t=this.rightRegionPosition,this.setRightRegionPosition(i),t!=this.rightRegionPosition&&this.refresh()))}.bind(this))}function AudioPage(t,e,i,o,n,s,a,r,l,h){Object.getPrototypeOf(AudioPage.prototype).constructor.call(this,t,e,i,o,n,s),this.audioContext=a,this.bufferSize=r,this.audioFileLoader=l,this.errorHandler=h,this.audioFiles={}}function BS1116Page(t,e,i,o,n,s,a,r,l,h,p,u){Object.getPrototypeOf(BS1116Page.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.reference=p,this.condition=u,this.mushraAudioControl=null,this.div=null,this.waveformVisualizer=null,this.currentItem=null,Object.getPrototypeOf(MushraPage.prototype).addAudioFile.call(this,this.reference.getFilepath(),this.reference),Object.getPrototypeOf(MushraPage.prototype).addAudioFile.call(this,this.condition.getFilepath(),this.condition),this.ratingB=null,this.ratingC=null,this.ratings=[],this.loop={start:null,end:null},this.slider={start:null,end:null},this.time=0,this.startTimeOnPage=null}function BS1116PageManager(){}function FilePlayerPage(t,e,i,o,n,s,a,r,l,h){Object.getPrototypeOf(FilePlayerPage.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.filePlayer=null,this.inputController=null}function FinishPage(t,e,i,o,n,s){Object.getPrototypeOf(FinishPage.prototype).constructor.call(this,t,e,i,o,n,s),this.errorDiv=$("<div style='color:red; font-weight:bold;'></div>")}function GenericPage(t,e,i,o,n,s){Object.getPrototypeOf(GenericPage.prototype).constructor.call(this,t,e,i,o,n,s)}function LikertMultiStimulusPage(t,e,i,o,n,s,a,r,l,h){for(var p in Object.getPrototypeOf(LikertMultiStimulusPage.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.time=0,this.startTimeOnPage=null,this.stimuli=[],i.stimuli)this.stimuli[this.stimuli.length]=new Stimulus(p,i.stimuli[p]);shuffle(this.stimuli);for(var u=0;u<this.stimuli.length;++u)Object.getPrototypeOf(LikertMultiStimulusPage.prototype).addAudioFile.call(this,this.stimuli[u].getFilepath(),this.stimuli[u]);this.stimulusResponses=[]}function LikertSingleStimulusPage(t,e,i,o,n,s,a,r,l,h,p){Object.getPrototypeOf(LikertSingleStimulusPage.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.stimulus=p,Object.getPrototypeOf(LikertSingleStimulusPage.prototype).addAudioFile.call(this,this.stimulus.getFilepath(),this.stimulus),this.waveformVisualizer=null,this.ratingMap={},this.time=0,this.startTimeOnPage=null}function LikertSingleStimulusPageManager(){}function MushraPage(t,e,i,o,n,s,a,r,l,h,p){for(var u in Object.getPrototypeOf(MushraPage.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.isMushra=!0,this.mushraValidator=p,this.mushraAudioControl=null,this.waveformVisualizer=null,this.macic=null,this.currentItem=null,this.tdLoop2=null,this.conditions=[],this.pageConfig.stimuli)this.conditions[this.conditions.length]=new Stimulus(u,this.pageConfig.stimuli[u]);this.reference=new Stimulus("reference",this.pageConfig.reference),Object.getPrototypeOf(MushraPage.prototype).addAudioFile.call(this,this.reference.getFilepath(),this.reference);for(var d=0;d<this.conditions.length;++d)Object.getPrototypeOf(MushraPage.prototype).addAudioFile.call(this,this.conditions[d].getFilepath(),this.conditions[d]);this.ratings=[],this.loop={start:null,end:null},this.slider={start:null,end:null},this.time=0,this.startTimeOnPage=null}function Page(t,e,i,o,n,s){this.pageManager=t,this.pageTemplateRenderer=e,this.pageConfig=i,this.session=o,this.language=n,this.dataSender=s,this.sendError=!1,void 0===this.pageConfig.questionnaire&&(this.pageConfig.questionnaire=[]),this.questionnaireResponses={},this.likertObjects={}}function PairedComparisonPage(t,e,i,o,n,s,a,r,l,h,p,u){Object.getPrototypeOf(PairedComparisonPage.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.reference=p,this.condition=u,this.mushraAudioControl=null,this.div=null,this.waveformVisualizer=null,this.macic=null,this.currentItem=null,Object.getPrototypeOf(PairedComparisonPage.prototype).addAudioFile.call(this,this.reference.getFilepath(),this.reference),Object.getPrototypeOf(PairedComparisonPage.prototype).addAudioFile.call(this,this.condition.getFilepath(),this.condition),this.choice=null,this.ratings=[],this.loop={start:null,end:null},this.slider={start:null,end:null},this.time=0,this.startTimeOnPage=null}function PairedComparisonPageManager(){}function SpatialPage(t,e,i,o,n,s,a,r,l,h){for(var p in Object.getPrototypeOf(SpatialPage.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.numberOfSpheres=this.pageConfig.numberofLocObj,this.time=(new Date).getTime(),this.stimuli=[],this.div=null,this.renderDivs=[],this.scenes=[],this.cameras=[],this.responses={},this.activeResponse=null,this.time=0,this.framerate=this.pageConfig.framerate,this.filePlayer=null,this.mouseDown=!1,i.stimuli)this.stimuli[this.stimuli.length]=new Stimulus(p,i.stimuli[p]);shuffle(this.stimuli);for(var u=0;u<this.stimuli.length;++u)Object.getPrototypeOf(SpatialPage.prototype).addAudioFile.call(this,this.stimuli[u].getFilepath(),this.stimuli[u])}function VolumePage(t,e,i,o,n,s,a,r,l,h){Object.getPrototypeOf(VolumePage.prototype).constructor.call(this,t,e,i,o,n,s,a,r,l,h),this.stimulus=new Stimulus("stimulus",i.stimulus),Object.getPrototypeOf(VolumePage.prototype).addAudioFile.call(this,this.pageConfig.stimulus,this.stimulus),this.audioContext.volume=this.volume=this.pageConfig.defaultVolume}function Camera(t,e){switch(this.type=t,this.camera=null,this.type){case CameraType.PERSPECTIVE:this.camera=new THREE.PerspectiveCamera(45,e.getAttribute("width")/e.getAttribute("height"),1,1e4);break;case CameraType.ORTHOGRAPHIC:this.camera=new THREE.OrthographicCamera(-e.getAttribute("width")/2,e.getAttribute("width")/2,e.getAttribute("height")/2,-e.getAttribute("height")/2,0,1e4);break;default:console.log("Unknown camera type.")}}function ASWObject(t){this.objConfig=t,this.group,this.height=t.height,this.depth=t.depth,null==t.depth&&(this.depth=20),null==t.height&&(this.height=0),this.x=0,this.y=0,this.z=0,this.geometryLine1=new THREE.Geometry,this.geometryLine2=new THREE.Geometry,this.controlPoints=[],this.controlPoints[0]=[],this.controlPoints[1]=[],this.controlPoints[2]=[],this.controlPoints[3]=[],0!=this.height&&(this.controlPoints[4]=[],this.controlPoints[5]=[]),this.controlPoints[0][0]=t.bezierOuterLeft[0],this.controlPoints[0][1]=t.bezierOuterLeft[1],this.controlPoints[0][2]=t.bezierOuterLeft[2],this.controlPoints[1][0]=t.bezierInnerLeft[0],this.controlPoints[1][1]=t.bezierInnerLeft[1],this.controlPoints[1][2]=t.bezierInnerLeft[2],this.controlPoints[2][0]=t.bezierInnerRight[0],this.controlPoints[2][1]=t.bezierInnerRight[1],this.controlPoints[2][2]=t.bezierInnerRight[2],this.controlPoints[3][0]=t.bezierOuterRight[0],this.controlPoints[3][1]=t.bezierOuterRight[1],this.controlPoints[3][2]=t.bezierOuterRight[2],this.derivative=[],this.midpointOnCurve=[],this.tmp=[],this.extrudeBend=null,this.activeObj=null,this.group=new THREE.Object3D,this.scene,this.line=[],this.points=[],this.material=[],this.geometrySphere=new THREE.SphereGeometry(8,34,30);for(var e=0;e<this.controlPoints.length;++e)this.material[e]=new THREE.MeshPhongMaterial({color:t.color,ambient:t.color,emmissive:t.color}),this.points[e]=new THREE.Mesh(this.geometrySphere,this.material[e]);this.update()}function LEVObject(t){this.objConfig=t,this.activeObj,this.materialLEV,this.mesh,this.point0=new THREE.Vector3(t.position[0],t.position[1],t.position[2]),this.point1=new THREE.Vector3(t.size[0]+t.position[0],t.position[1],0),this.point2=new THREE.Vector3(0,t.position[1],t.size[2]+t.position[2]),this.point3=new THREE.Vector3(t.position[0],t.size[1]+t.position[1],t.position[2]),this.xAxis=null,this.yAxis=null,this.zAxis=null,this.dragNdrop0=null,this.dragNdrop1=null,this.material1,this.dragNdrop2=null,this.material1,this.material0=new THREE.MeshPhongMaterial({color:t.color,opacitiy:.1,ambient:3342336}),this.material1=new THREE.MeshPhongMaterial({color:t.color,opacitiy:.1,ambient:3342336}),this.material2=new THREE.MeshPhongMaterial({color:t.color,opacitiy:.1,ambient:3342336}),this.material3=new THREE.MeshPhongMaterial({color:t.color,opacitiy:.1,ambient:3342336});var e=new THREE.SphereGeometry(8,34,30);this.dragNdrop0=new THREE.Mesh(e,this.material0),this.dragNdrop0.position.x=this.point0.x,this.dragNdrop0.position.y=this.point0.y,this.dragNdrop0.position.z=this.point0.z,this.dragNdrop1=new THREE.Mesh(e,this.material1),this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.y=this.point1.y,this.dragNdrop1.position.z=this.point1.z,this.dragNdrop2=new THREE.Mesh(e,this.material2),this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.y=this.point2.y,this.dragNdrop2.position.z=this.point2.z,this.dragNdrop3=new THREE.Mesh(e,this.material3),this.dragNdrop3.position.x=this.point3.x,this.dragNdrop3.position.y=this.point3.y,this.dragNdrop3.position.z=this.point3.z;e=new THREE.Geometry;e.vertices.push(this.dragNdrop0.position),e.vertices.push(this.dragNdrop1.position),this.xAxis=new THREE.Line(e,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip);e=new THREE.Geometry;e.vertices.push(this.dragNdrop0.position),e.vertices.push(this.dragNdrop2.position),this.yAxis=new THREE.Line(e,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip);e=new THREE.Geometry;e.vertices.push(this.dragNdrop0.position),e.vertices.push(this.dragNdrop3.position),this.zAxis=new THREE.Line(e,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip),this.materialLEV=new THREE.MeshPhongMaterial({color:t.color,opacity:.5,transparent:!0,ambient:3342336}),this.geometry=new THREE.SphereGeometry(1,50,50),this.mesh=new THREE.Mesh(this.geometry,this.materialLEV),this.setPosition0(this.point0.x,this.point0.y,this.point0.z),this.setPosition1(this.point1.x,this.point1.y,this.point1.z),this.setPosition2(this.point2.x,this.point2.y,this.point2.z),this.setPosition3(this.point3.x,this.point3.y,this.point3.z)}function LocalizationObject(t){this.objConfig=t,this.material=new THREE.MeshPhongMaterial({color:t.color,ambient:3342336,emmissive:2236962}),this.geometry=new THREE.SphereGeometry(t.size,34,30),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.position.x=t.position[0],this.mesh.position.y=t.position[1],this.mesh.position.z=t.position[2]}function SpatialObject(t){this.scene=t}function Scene(t,e,i,o){this.pageConfig=i,this.scene=new THREE.Scene,this.parser=new DOMParser,this.wmCamera=e,this.camera=e.getCamera(),this.viewConfig=o,this.renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(t.getAttribute("width"),t.getAttribute("height")),t.appendChild(this.renderer.domElement),this.divHeight=t.getAttribute("height"),this.height=null,this.width=null,this.depth=null,this.materialWall=null,this.material=null,this.materialWallLeft=null,this.materialWallRight=null,this.materialFloor=null,this.materialCeiling=null,this.ambient=null,this.wallLeft=null,this.wallRight=null,this.wall=null,this.wallfront=null,this.floor=null,this.ceiling=null}AudioFileLoader.prototype.addFile=function(t,e,i){this.files[this.files.length]={url:t,callback:e,callbackArgument:i}},AudioFileLoader.prototype.startLoading=function(i){$.mobile.loading("show",{text:"Loading...",textVisible:!0,theme:"a",html:""}),0===this.files.length&&i();for(var t=0;t<this.files.length;++t){var e=new XMLHttpRequest;e.open("GET",this.files[t].url,!0),e.responseType="arraybuffer",e.onerror=function(t){this.errorHandler.sendError("Loading audio file failed: "+t),i()}.bind(this);var o={index:t,loader:this,request:e};e.onload=function(){this.loader.audioContext.decodeAudioData(this.request.response,function(t){this.loader.files[this.index].callback(t,this.loader.files[this.index].callbackArgument),this.loader.files[this.index]=null;for(var e=0;e<this.loader.files.length;++e)if(null!=this.loader.files[e])return;this.loader.files=[],i()}.bind(this),function(t){this.errorHandler.sendError("Loading audio file failed: "+t),i()}.bind(this.loader))}.bind(o),e.send()}},GenericAudioControl.prototype.removeEventListener=function(t){this.eventListeners[t]=null},GenericAudioControl.prototype.addEventListener=function(t){return this.eventListeners[this.eventListeners.length]=t,this.eventListeners.length-1},GenericAudioControl.prototype.sendEvent=function(t){for(var e=0;e<this.eventListeners.length;++e)null!==this.eventListeners[e]&&this.eventListeners[e](t)},GenericAudioControl.prototype.play=function(t){null===this.audioStimulusIndex?(this.audioStimulusIndex=t,this.audioCommand="play"):this.audioStimulusIndex!==t&&(this.audioCommand="switch",this.audioCommandSwitchIndex=t)},GenericAudioControl.prototype.stop=function(){null!==this.audioStimulusIndex&&(this.audioCommand="stop",this.audioStimulusIndex=null)},GenericAudioControl.prototype.pause=function(){null!==this.audioStimulusIndex&&(this.audioCommand="pause")},GenericAudioControl.prototype.getPosition=function(t){return this.audioCurrentPositions[t]},GenericAudioControl.prototype.getDuration=function(t){return this.audioMaxPositions[t]},GenericAudioControl.prototype.initAudio=function(){for(this.audioMaxPositions=[],this.audioCurrentPositions=[],e=0;e<this.stimuli.length;++e)this.audioCurrentPositions[e]=0,this.audioMaxPositions[e]=this.stimuli[e].getAudioBuffer().length;this.dummyBufferSource=this.audioContext.createBufferSource(),this.dummyBufferSource.loop=!0,this.dummyBufferSource.buffer=this.audioContext.createBuffer(1,this.bufferSize,this.audioContext.sampleRate);for(var t=0,e=0;e<this.stimuli.length;++e)channels=this.stimuli[e].getAudioBuffer().numberOfChannels,channels>t&&(t=channels);var i=2<t?this.audioContext.destination.channelCount:t;this.scriptNode=this.audioContext.createScriptProcessor(this.bufferSize,1,i),this.scriptNode.onaudioprocess=function(t){this.process(t)}.bind(this),this.dummyBufferSource.connect(this.scriptNode),this.scriptNode.connect(this.audioContext.destination),this.dummyBufferSource.start()},GenericAudioControl.prototype.freeAudio=function(){this.stop(),this.dummyBufferSource.disconnect(),this.scriptNode.disconnect(),this.scriptNode.onaudioprocess=null,this.dummyBufferSource=null,this.scriptNode=null},GenericAudioControl.prototype.process=function(t){var e,i,o=t.outputBuffer,n=(t.inputBuffer,this.audioStimulusIndex),s=this.audioCommandSwitchIndex;if(null!==n){var a=this.stimuli[n],r=a.getAudioBuffer(),l=null;if("switch"===this.audioCommand){d=null;for(var h=this.stimuli[s].getAudioBuffer(),p=0;p<a.getAudioBuffer().numberOfChannels;++p){e=o.getChannelData(p),i=r.getChannelData(p);for(var u=h.getChannelData(p),l=this.audioCurrentPositions[n],d=this.audioCurrentPositions[s],g=0;g<o.length;++g)e[g]=i[l++]*(1-g/o.length)+u[d++]*(g/o.length),l>=this.audioMaxPositions[n]&&(l=0,c={name:"ended",index:n},this.sendEvent(c),this.stop()),d>=this.audioMaxPositions[s]&&(d=0,c={name:"ended",index:s},this.sendEvent(c),this.stop())}}else for(p=0;p<a.getAudioBuffer().numberOfChannels;++p)for(e=o.getChannelData(p),i=r.getChannelData(p),l=this.audioCurrentPositions[n],g=0;g<o.length;++g)e[g]=i[l++],l>=this.audioMaxPositions[n]&&(l=0,c={name:"ended",index:n},this.sendEvent(c),this.stop());if(this.audioCurrentPositions[n]=l,"pause"===this.audioCommand||"stop"===this.audioCommand){for(p=0;p<o.numberOfChannels;++p)for(e=o.getChannelData(p),g=0;g<o.length;++g)e[g]=e[g]*(1-g/o.length);this.audioStimulusIndex=null,"stop"===this.audioCommand&&(this.audioCurrentPositions[n]=0)}if("play"===this.audioCommand)for(p=0;p<o.numberOfChannels;++p)for(e=o.getChannelData(p),g=0;g<o.length;++g)e[g]=e[g]*(g/o.length);for(p=0;p<o.numberOfChannels;++p)for(e=o.getChannelData(p),g=0;g<o.length;++g)e[g]=e[g]*this.audioContext.volume;var c={name:"processUpdate",currentSample:l,numSamples:this.audioMaxPositions[n],index:n};this.sendEvent(c),"switch"===this.audioCommand&&(this.audioCurrentPositions[s]=d,this.audioStimulusIndex=s,c={name:"processUpdate",currentSample:d,numSamples:this.audioMaxPositions[s],index:s},this.sendEvent(c)),this.audioCommand=null}else for(p=0;p<o.numberOfChannels;++p)for(e=o.getChannelData(p),g=0;g<o.length;++g)e[g]=0},GenericAudioControl.prototype.setPosition=function(t,e){var i=this.audioStimulusIndex;null==i&&(i=0),this.audioCurrentPositions[i]=t;i={name:"processUpdate",currentSample:this.audioCurrentPositions[i],numSamples:this.audioMaxPositions[i],index:i};this.sendEvent(i)},MushraAudioControl.prototype.createLowerAnchor35=function(t){var e=new Stimulus("anchor35",null),i={16e3:[.00146057475,-.000353625658,-.00211669048,133181901e-25,.00283327134,.00063539025,-.00354377515,-.00160293357,.00415933602,.00293859058,-.00456995224,-.00465872931,.00464644276,.00675606346,-.00424229906,-.00919716509,.00319389291,.0119219071,-.00131632725,-.0148450328,-.00161017158,.017859864,.00587395476,-.0208439639,-.0119108739,.0236663818,.0204970606,-.0261959511,-.0332797851,.028309993,.0545868177,-.029902726,-.100469275,.0308926832,.316213188,.468427729,.316213188,.0308926832,-.100469275,-.029902726,.0545868177,.028309993,-.0332797851,-.0261959511,.0204970606,.0236663818,-.0119108739,-.0208439639,.00587395476,.017859864,-.00161017158,-.0148450328,-.00131632725,.0119219071,.00319389291,-.00919716509,-.00424229906,.00675606346,.00464644276,-.00465872931,-.00456995224,.00293859058,.00415933602,-.00160293357,-.00354377515,.00063539025,.00283327134,133181901e-25,-.00211669048,-.000353625658,.00146057475],22050:[.000952605741,-540270522e-13,-.00127762947,-.00131042292,.000190025918,.00182536152,.00170992319,-.000409988577,-.00250271626,-.00214566819,.000737474512,.00332812369,.00261061454,-.00120067309,-.00432364806,-.00309626869,.00183427383,.00551743347,.0035929075,-.00268271981,-.00694789149,-.00408985769,.00380597669,.00867104429,.00457582413,-.00529011523,-.0107739692,-.00503925474,.00726774322,.013401003,.00546872754,-.00996041093,-.0168093503,-.00585334427,.0137758737,.0215014677,.00618311408,-.0195648167,-.0285953063,-.00644931146,.0294554368,.0411458005,.00664479278,-.0506925442,-.0714114073,-.00676425808,.134027797,.278911088,.340222334,.278911088,.134027797,-.00676425808,-.0714114073,-.0506925442,.00664479278,.0411458005,.0294554368,-.00644931146,-.0285953063,-.0195648167,.00618311408,.0215014677,.0137758737,-.00585334427,-.0168093503,-.00996041093,.00546872754,.013401003,.00726774322,-.00503925474,-.0107739692,-.00529011523,.00457582413,.00867104429,.00380597669,-.00408985769,-.00694789149,-.00268271981,.0035929075,.00551743347,.00183427383,-.00309626869,-.00432364806,-.00120067309,.00261061454,.00332812369,.000737474512,-.00214566819,-.00250271626,-.000409988577,.00170992319,.00182536152,.000190025918,-.00131042292,-.00127762947,-540270522e-13,.000952605741],32e3:[.000606868162,.000143747395,-.000489683231,-.000957379936,-.000960325242,-.000417728904,.000449945168,.00120031549,.00138937936,.000825904537,-.00028215794,-.00138886266,-.0018728162,-.0013784479,-521614709e-13,.00147437405,.00237664707,.00207495799,.000588782307,-.00140129392,-.00285363105,-.00290225508,-.00135803188,.00110897785,.0032433065,.00383275857,.00238254276,-.000533301611,-.00347219682,-.00482346902,-.00367593495,-.000392692298,.0034535061,.00581536918,.00524301539,.00174034066,-.00308500074,-.00673269714,-.00708234698,-.00359130075,.00224251785,.00748083884,.00919271334,.00605234225,-.000763633833,-.00793999457,-.0115868202,-.00928931164,-.00159164371,.00794756191,.0143209098,.0136079502,.00523968294,-.00724896864,-.0175669342,-.0196698839,-.0110538132,.00534562546,.0218284858,.0292009619,.0213598555,-.000901475403,-.0288345136,-.0483076339,-.0452805665,-.0120351498,.0485303746,.122599703,.189585306,.229288491,.229288491,.189585306,.122599703,.0485303746,-.0120351498,-.0452805665,-.0483076339,-.0288345136,-.000901475403,.0213598555,.0292009619,.0218284858,.00534562546,-.0110538132,-.0196698839,-.0175669342,-.00724896864,.00523968294,.0136079502,.0143209098,.00794756191,-.00159164371,-.00928931164,-.0115868202,-.00793999457,-.000763633833,.00605234225,.00919271334,.00748083884,.00224251785,-.00359130075,-.00708234698,-.00673269714,-.00308500074,.00174034066,.00524301539,.00581536918,.0034535061,-.000392692298,-.00367593495,-.00482346902,-.00347219682,-.000533301611,.00238254276,.00383275857,.0032433065,.00110897785,-.00135803188,-.00290225508,-.00285363105,-.00140129392,.000588782307,.00207495799,.00237664707,.00147437405,-521614709e-13,-.0013784479,-.0018728162,-.00138886266,-.00028215794,.000825904537,.00138937936,.00120031549,.000449945168,-.000417728904,-.000960325242,-.000957379936,-.000489683231,.000143747395,.000606868162],44100:[.000385585487,.000133034743,-.000194118449,-.000505722104,-.000704834248,-.000716894007,-.000515420887,-.000135834153,.000328234037,.000746924123,.000989641735,.000964595401,.000650699563,.000111322602,-.000516136594,-.00105407906,-.00133398588,-.00124774623,-.000785754644,-490812421e-13,.000770326741,.00143838339,.00174455797,.00156640738,.000913606436,-634018697e-13,-.0011057284,-.00191319916,-.00222936025,-.00192063974,-.00102578505,.000241433178,.00154080481,.00249532689,.00279877877,.00231100982,.00111200144,-.000504343499,-.0020994943,-.00320719753,-.00346741253,-.00273942131,-.00115952039,.000877685355,.00281463346,.00408072966,.00425727013,.00321052111,.00115194504,-.00139728242,-.00373423174,-.00516439618,-.00520361645,-.00373421028,-.00106679354,.00211705467,.00493360865,.00653696348,.00636639211,.00433049385,.000870420254,-.00312520748,-.00654071007,-.00833647519,-.00785458392,-.00503985239,-.000506491547,.00458108702,.00879468,.0108285771,.00988481876,.0059485687,-.000133497735,-.00681123281,-.0122025771,-.0145947015,-.0129478282,-.00726293801,.00130073897,.0106152311,.0180600648,.02118718,.0184183105,.00959660845,-.00376347351,-.0186204222,-.0309450406,-.0365583033,-.0320911389,-.015848259,.0116325554,.0474743894,.0868589947,.123865178,.15258148,.16825952,.16825952,.15258148,.123865178,.0868589947,.0474743894,.0116325554,-.015848259,-.0320911389,-.0365583033,-.0309450406,-.0186204222,-.00376347351,.00959660845,.0184183105,.02118718,.0180600648,.0106152311,.00130073897,-.00726293801,-.0129478282,-.0145947015,-.0122025771,-.00681123281,-.000133497735,.0059485687,.00988481876,.0108285771,.00879468,.00458108702,-.000506491547,-.00503985239,-.00785458392,-.00833647519,-.00654071007,-.00312520748,.000870420254,.00433049385,.00636639211,.00653696348,.00493360865,.00211705467,-.00106679354,-.00373421028,-.00520361645,-.00516439618,-.00373423174,-.00139728242,.00115194504,.00321052111,.00425727013,.00408072966,.00281463346,.000877685355,-.00115952039,-.00273942131,-.00346741253,-.00320719753,-.0020994943,-.000504343499,.00111200144,.00231100982,.00279877877,.00249532689,.00154080481,.000241433178,-.00102578505,-.00192063974,-.00222936025,-.00191319916,-.0011057284,-634018697e-13,.000913606436,.00156640738,.00174455797,.00143838339,.000770326741,-490812421e-13,-.000785754644,-.00124774623,-.00133398588,-.00105407906,-.000516136594,.000111322602,.000650699563,.000964595401,.000989641735,.000746924123,.000328234037,-.000135834153,-.000515420887,-.000716894007,-.000704834248,-.000505722104,-.000194118449,.000133034743,.000385585487],48e3:[.000265962912,269444584e-13,-.000248821161,-.000494662851,-.000643796534,-.000646775759,-.000486311783,-.00018528049,.000194893397,.000566035055,.000833148354,.00091809972,.000781287127,.000435505261,-522979429e-13,-.000572944907,-.000998822202,-.00121452462,-.00114713457,-.000788392101,-.000202420545,.000484181162,.00110885003,.00151084654,.00157170064,.00124833405,.000589933696,-.000266953314,-.00112557915,-.00177332628,-.00203342793,-.00181170379,-.00112625841,-.000111457054,.00100671953,.00195990923,.00250073799,.00246559981,.00182121733,.00068227443,-.000706303532,-.00202053023,-.00293168746,-.00318704737,-.00267749645,-.00147446748,.000175042337,.00189701892,.00327357683,.00394261376,.00369060569,.00251528679,.000640787624,-.00152170555,-.00346182551,-.00468821039,-.00485014653,-.00383316972,-.00180350513,.000812985611,.00341669253,.00536850308,.00614306024,.00546508185,.00339445006,.000335843306,-.00303472869,-.00591458059,-.00756029023,-.00747297626,-.0055381722,-.00208327545,.00216735243,.00623652135,.00911056463,.00998170297,.00846059896,.00470613719,-.000565026394,-.00620120019,-.0108526668,-.0132768685,-.0126461656,-.00878669367,-.00228687538,.00556114655,.0129890766,.0181131879,.0193598332,.0158676325,.00777636434,-.00366989653,-.0162436399,-.0270725072,-.0331434635,-.0318828143,-.0217012916,-.00239409277,.0246911341,.0567636975,.0899696543,.119982256,.142700869,.154932754,.154932754,.142700869,.119982256,.0899696543,.0567636975,.0246911341,-.00239409277,-.0217012916,-.0318828143,-.0331434635,-.0270725072,-.0162436399,-.00366989653,.00777636434,.0158676325,.0193598332,.0181131879,.0129890766,.00556114655,-.00228687538,-.00878669367,-.0126461656,-.0132768685,-.0108526668,-.00620120019,-.000565026394,.00470613719,.00846059896,.00998170297,.00911056463,.00623652135,.00216735243,-.00208327545,-.0055381722,-.00747297626,-.00756029023,-.00591458059,-.00303472869,.000335843306,.00339445006,.00546508185,.00614306024,.00536850308,.00341669253,.000812985611,-.00180350513,-.00383316972,-.00485014653,-.00468821039,-.00346182551,-.00152170555,.000640787624,.00251528679,.00369060569,.00394261376,.00327357683,.00189701892,.000175042337,-.00147446748,-.00267749645,-.00318704737,-.00293168746,-.00202053023,-.000706303532,.00068227443,.00182121733,.00246559981,.00250073799,.00195990923,.00100671953,-.000111457054,-.00112625841,-.00181170379,-.00203342793,-.00177332628,-.00112557915,-.000266953314,.000589933696,.00124833405,.00157170064,.00151084654,.00110885003,.000484181162,-.000202420545,-.000788392101,-.00114713457,-.00121452462,-.000998822202,-.000572944907,-522979429e-13,.000435505261,.000781287127,.00091809972,.000833148354,.000566035055,.000194893397,-.00018528049,-.000486311783,-.000646775759,-.000643796534,-.000494662851,-.000248821161,269444584e-13,.000265962912]}[t.sampleRate.toString()];return null===i?(this.errorHandler.sendError("Sample size"+t.sampleRate+" is not supported for creating anchors."),null):(e.setAudioBuffer(this.convolve(t,i)),e)},MushraAudioControl.prototype.createLowerAnchor70=function(t){var e=new Stimulus("anchor70",null),i={16e3:[-.00118209226,.00100896033,-.000618592779,-30648982e-28,.000828010143,-.00181288756,.0028680964,-.00387720074,.00470245853,-.00519757939,.00522375966,-.00466760994,.00345919995,-.00158821811,-.000883779279,.00381685249,-.00699329572,.0101261709,-.012875787,.0148733309,-.0157500548,.0151697236,-.0128615154,.00865031066,-.00248133933,-.00556350253,.0152597233,-.0262458867,.03804101,-.0500727925,.0617147172,-.0723291806,.0813131625,-.0881426193,.0924118081,.907353278,.0924118081,-.0881426193,.0813131625,-.0723291806,.0617147172,-.0500727925,.03804101,-.0262458867,.0152597233,-.00556350253,-.00248133933,.00865031066,-.0128615154,.0151697236,-.0157500548,.0148733309,-.012875787,.0101261709,-.00699329572,.00381685249,-.000883779279,-.00158821811,.00345919995,-.00466760994,.00522375966,-.00519757939,.00470245853,-.00387720074,.0028680964,-.00181288756,.000828010143,-30648982e-28,-.000618592779,.00100896033,-.00118209226],22050:[-.00109204743,.000364387668,.00100704951,-.00153304385,.000365790771,.00151198395,-.0020376718,.000291370261,.00216171702,-.00260011167,.000112849298,.0029784736,-.00321181316,-.000203222908,.00398744555,-.00386164534,-.000697103657,.00521902698,-.00453617643,-.00141884616,.00671283398,-.00522007536,-.00243379393,.00852493523,-.00589662042,-.00383289594,.0107412503,-.00654829386,-.00575289893,.0135037854,-.00715743651,-.00841856686,.0170663665,-.0077069323,-.0122398534,.0219272797,-.00818089034,-.0180687354,.0292000372,-.00856529187,-.0280344748,.0419362692,-.00884857023,-.0493861012,.0723989052,-.00902209522,-.132916342,.280240308,.658338972,.280240308,-.132916342,-.00902209522,.0723989052,-.0493861012,-.00884857023,.0419362692,-.0280344748,-.00856529187,.0292000372,-.0180687354,-.00818089034,.0219272797,-.0122398534,-.0077069323,.0170663665,-.00841856686,-.00715743651,.0135037854,-.00575289893,-.00654829386,.0107412503,-.00383289594,-.00589662042,.00852493523,-.00243379393,-.00522007536,.00671283398,-.00141884616,-.00453617643,.00521902698,-.000697103657,-.00386164534,.00398744555,-.000203222908,-.00321181316,.0029784736,.000112849298,-.00260011167,.00216171702,.000291370261,-.0020376718,.00151198395,.000365790771,-.00153304385,.00100704951,.000364387668,-.00109204743],32e3:[-.000769448174,-.000102908895,.000882007876,.000402489768,-.000908180556,-.000758018375,.000816478586,.00113513958,-.000584105594,-.00148760313,.000201997134,.00176093904,.000321000527,-.00189789137,-.000955484664,.00184520796,.00165095747,-.00156116233,-.00233779021,.00102301221,.0029318393,-.000233502393,-.00334157226,-.000774482154,.0034772551,.00193590651,-.00326146644,-.00315481067,.00263997272,.00430907238,-.00159185405,-.00525866243,.000137737071,.00585697226,.00165491779,-.00596443449,-.00367031062,.00546335487,.00574708382,-.00427266973,-.00768547855,.00236126969,.0092584779,.000241387121,-.0102260537,-.00343839395,.0103511491,.00706282811,-.00941556234,-.0108794297,.0072334174,.014589529,-.00365926237,-.017836807,-.00141335654,.020208968,.00806981719,-.0212250788,-.0164233734,.0202846888,.0267322768,-.0165130681,-.0397002851,.00827992408,.0574112325,.00861597499,-.0874119634,-.0515418427,.179291016,.416071015,.416071015,.179291016,-.0515418427,-.0874119634,.00861597499,.0574112325,.00827992408,-.0397002851,-.0165130681,.0267322768,.0202846888,-.0164233734,-.0212250788,.00806981719,.020208968,-.00141335654,-.017836807,-.00365926237,.014589529,.0072334174,-.0108794297,-.00941556234,.00706282811,.0103511491,-.00343839395,-.0102260537,.000241387121,.0092584779,.00236126969,-.00768547855,-.00427266973,.00574708382,.00546335487,-.00367031062,-.00596443449,.00165491779,.00585697226,.000137737071,-.00525866243,-.00159185405,.00430907238,.00263997272,-.00315481067,-.00326146644,.00193590651,.0034772551,-.000774482154,-.00334157226,-.000233502393,.0029318393,.00102301221,-.00233779021,-.00156116233,.00165095747,.00184520796,-.000955484664,-.00189789137,.000321000527,.00176093904,.000201997134,-.00148760313,-.000584105594,.00113513958,.000816478586,-.000758018375,-.000908180556,.000402489768,.000882007876,-.000102908895,-.000769448174],44100:[-.000532571035,-.000132887083,.000459904635,.000651259705,.000189344568,-.000526843122,-.000783572104,-.000259251594,.000593819841,.000930096627,.000344234469,-.000659745775,-.00109139499,-.000446021415,.00072340291,.00126800749,.000566454777,-.000783437815,-.00146046149,-.000707508266,.00083835339,.00166928376,.000871310809,-.000886497904,-.0018950178,-.00106017909,.00092605019,.00213824725,.0012766615,-.000954999454,-.00239962702,-.00152359736,.000971117574,.00267992457,.00180419637,-.000971920987,-.00298007442,-.00212214573,.000954618037,.00330125036,.00248175508,-.000916035917,-.00364496198,-.0028881542,.000852518629,.00401318497,.00334756566,-.000759783224,-.00440853985,-.00386768584,.000632714888,.00483454113,.0044582262,-.000465070593,-.00529595233,-.00513169752,.000249042659,.00579930374,.00590457233,253982932e-13,-.00635366889,-.00679905528,-.000371519121,.00697186608,.00784586582,.000807445389,-.00767238735,-.00908877832,-.00135884995,.0084826305,.0105923658,.00206362319,-.00944459856,-.0124559362,-.00298045962,.0106255937,.0148403291,.00420580554,-.0121398987,-.0180239389,-.00591049403,.0141973598,.0225334267,.00842914035,-.0172279931,-.0294984949,-.0125189233,.0222704419,.0418581019,.020334996,-.0326317143,-.0703914922,-.0414222929,.0674969577,.212121469,.314412351,.314412351,.212121469,.0674969577,-.0414222929,-.0703914922,-.0326317143,.020334996,.0418581019,.0222704419,-.0125189233,-.0294984949,-.0172279931,.00842914035,.0225334267,.0141973598,-.00591049403,-.0180239389,-.0121398987,.00420580554,.0148403291,.0106255937,-.00298045962,-.0124559362,-.00944459856,.00206362319,.0105923658,.0084826305,-.00135884995,-.00908877832,-.00767238735,.000807445389,.00784586582,.00697186608,-.000371519121,-.00679905528,-.00635366889,253982932e-13,.00590457233,.00579930374,.000249042659,-.00513169752,-.00529595233,-.000465070593,.0044582262,.00483454113,.000632714888,-.00386768584,-.00440853985,-.000759783224,.00334756566,.00401318497,.000852518629,-.0028881542,-.00364496198,-.000916035917,.00248175508,.00330125036,.000954618037,-.00212214573,-.00298007442,-.000971920987,.00180419637,.00267992457,.000971117574,-.00152359736,-.00239962702,-.000954999454,.0012766615,.00213824725,.00092605019,-.00106017909,-.0018950178,-.000886497904,.000871310809,.00166928376,.00083835339,-.000707508266,-.00146046149,-.000783437815,.000566454777,.00126800749,.00072340291,-.000446021415,-.00109139499,-.000659745775,.000344234469,.000930096627,.000593819841,-.000259251594,-.000783572104,-.000526843122,.000189344568,.000651259705,.000459904635,-.000132887083,-.000532571035],48e3:[-.000382564326,626346183e-13,.00050768613,.000555633678,.000116282009,-.000476780129,-.000714904767,-.000347718209,.000365758872,.000832102312,.00061416739,-.000165826429,-.0008775865,-.000888589942,-.000121570886,.000824131005,.00113600937,.000482705267,-.000651095587,-.00131644851,-.000890743918,.000348525498,.00138905036,.00130643989,793456875e-13,-.00131706068,-.00168049112,-.000611711544,.0010732018,.00195754148,.00121038371,-.000644859068,-.00208160065,-.00182088957,384493874e-13,.00200246734,.00237562998,.000717642614,-.00168257606,-.00279903645,-.00157208738,.00110357317,.00301443897,.00245196246,-.000271881056,-.00295213872,-.00326659165,-.000777458991,.00255799998,.00391378054,.00197926022,-.00180175714,-.00428809769,-.00323938485,.000684194667,.00429060879,.00443881131,.000757587079,-.00383927574,-.00544043235,-.00244745458,.0028791113,.00609813465,.00427046011,-.00139115414,-.00626741483,-.00607605131,-.000600584332,.00581652723,.00768391283,.00302483882,-.00463694558,-.00889158112,-.00576176238,.00265173991,.00948233399,.00864431517,.000179740322,-.00923091568,-.0114613327,-.00386290552,.00790296283,.013959864,.00837781643,-.00524027235,-.0158415386,-.013704186,.000914425627,.0167405873,.0198772964,.00559761815,-.0161492402,-.0271234522,-.0153659305,.0131726637,.0362618849,.0312154049,-.0055652663,-.0503789399,-.0637602398,-.0162502462,.0884466598,.209778037,.290764233,.290764233,.209778037,.0884466598,-.0162502462,-.0637602398,-.0503789399,-.0055652663,.0312154049,.0362618849,.0131726637,-.0153659305,-.0271234522,-.0161492402,.00559761815,.0198772964,.0167405873,.000914425627,-.013704186,-.0158415386,-.00524027235,.00837781643,.013959864,.00790296283,-.00386290552,-.0114613327,-.00923091568,.000179740322,.00864431517,.00948233399,.00265173991,-.00576176238,-.00889158112,-.00463694558,.00302483882,.00768391283,.00581652723,-.000600584332,-.00607605131,-.00626741483,-.00139115414,.00427046011,.00609813465,.0028791113,-.00244745458,-.00544043235,-.00383927574,.000757587079,.00443881131,.00429060879,.000684194667,-.00323938485,-.00428809769,-.00180175714,.00197926022,.00391378054,.00255799998,-.000777458991,-.00326659165,-.00295213872,-.000271881056,.00245196246,.00301443897,.00110357317,-.00157208738,-.00279903645,-.00168257606,.000717642614,.00237562998,.00200246734,384493874e-13,-.00182088957,-.00208160065,-.000644859068,.00121038371,.00195754148,.0010732018,-.000611711544,-.00168049112,-.00131706068,793456875e-13,.00130643989,.00138905036,.000348525498,-.000890743918,-.00131644851,-.000651095587,.000482705267,.00113600937,.000824131005,-.000121570886,-.000888589942,-.0008775865,-.000165826429,.00061416739,.000832102312,.000365758872,-.000347718209,-.000714904767,-.000476780129,.000116282009,.000555633678,.00050768613,626346183e-13,-.000382564326]}[t.sampleRate.toString()];return null===i?(this.errorHandler.sendError("Sample size"+t.sampleRate+" is not supported for creating anchors."),null):(e.setAudioBuffer(this.convolve(t,i)),e)},MushraAudioControl.prototype.convolve=function(t,e){for(var i=this.audioContext.createBuffer(t.numberOfChannels,t.length,t.sampleRate),o=0;o<t.numberOfChannels;++o){for(var n=t.getChannelData(o),s=new Float32Array(t.length+e.length-1),a=0;a<t.length+e.length-1;++a){s[a]=0;for(var r=a>=e.length-1?a-(e.length-1):0,l=a<t.length-1?a:t.length-1,h=r;h<=l;++h)s[a]+=n[h]*e[a-h]}for(var p=i.getChannelData(o),u=e.length-1,d=0;d<i.length;++d)p[d]=s[u+d]}return i},MushraAudioControl.prototype.removeEventListener=function(t){this.eventListeners[t]=null},MushraAudioControl.prototype.addEventListener=function(t){return this.eventListeners[this.eventListeners.length]=t,this.eventListeners.length-1},MushraAudioControl.prototype.sendEvent=function(t){for(var e=0;e<this.eventListeners.length;++e)null!==this.eventListeners[e]&&this.eventListeners[e](t)},MushraAudioControl.prototype.getPosition=function(){return this.audioCurrentPosition},MushraAudioControl.prototype.getDuration=function(){return this.audioMaxPosition},MushraAudioControl.prototype.initAudio=function(){this.dummyBufferSource=this.audioContext.createBufferSource(),this.dummyBufferSource.loop=!0,this.dummyBufferSource.buffer=this.audioContext.createBuffer(1,this.bufferSize,this.audioContext.sampleRate);var t=2<this.reference.getAudioBuffer().numberOfChannels?this.audioContext.destination.channelCount:this.reference.getAudioBuffer().numberOfChannels;this.scriptNode=this.audioContext.createScriptProcessor(this.bufferSize,1,t),this.scriptNode.onaudioprocess=function(t){this.process(t)}.bind(this),this.dummyBufferSource.connect(this.scriptNode),this.scriptNode.connect(this.audioContext.destination),this.dummyBufferSource.start()},MushraAudioControl.prototype.freeAudio=function(){this.stop(),this.dummyBufferSource.disconnect(),this.scriptNode.disconnect(),this.scriptNode.onaudioprocess=null,this.dummyBufferSource=null,this.scriptNode=null},MushraAudioControl.prototype.setLoopingActive=function(t){this.audioLoopingActive=t},MushraAudioControl.prototype.isLoopingActive=function(){return this.audioLoopingActive},MushraAudioControl.prototype.process=function(t){var e,i,o=t.outputBuffer,n=(t.inputBuffer,this.audioStimulus);if(null!==n&&!1!==this.audioPlaying){var s=n.getAudioBuffer();this.audioCurrentPosition<this.audioLoopStart&&(this.audioCurrentPosition=this.audioLoopStart),null!==this.audioCurrentPositionRequest&&(this.audioCurrentPosition=this.audioCurrentPositionRequest,this.audioCurrentPositionRequest=null),null!==this.audioFadingActiveRequest&&(this.audioFadingActive=this.audioFadingActiveRequest,this.audioFadingActiveRequest=null);for(var a=null,r=null,l=null,h=this.audioLoopingActive,p=0;p<this.reference.getAudioBuffer().numberOfChannels;++p){i=o.getChannelData(p),inputData=s.getChannelData(p),a=this.audioCurrentPosition,r=this.audioFadingCurrentPosition,l=this.audioFadingActive;for(var u=0;u<o.length;++u){if(h&&a==this.audioLoopEnd-this.audioFadingMaxPosition&&(l=1,this.audioFadingIn=this.audioStimulus,r=0),1==l){if(e=.5*(1+Math.cos(Math.PI*r++/(this.audioFadingMaxPosition-1))),i[u]=inputData[a++]*e,r>=this.audioFadingMaxPosition){if(l=2,r=0,null===this.audioFadingIn){for(this.audioPlaying=!1,l=r=0;u<o.length;++u)i[u]=0;break}n=this.audioStimulus=this.audioFadingIn,inputData=n.getAudioBuffer().getChannelData(p)}}else 2==l?(e=.5*(1-Math.cos(Math.PI*r++/(this.audioFadingMaxPosition-1))),i[u]=inputData[a++]*e,r>=this.audioFadingMaxPosition&&(l=r=0)):i[u]=inputData[a++];a>=this.audioLoopEnd&&(a=this.audioLoopStart,!1===h&&(this.audioPlaying=!1))}}for(p=0;p<o.numberOfChannels;++p)for(i=o.getChannelData(p),u=0;u<o.length;++u)i[u]=i[u]*this.audioContext.volume;this.audioCurrentPosition=a,this.audioFadingCurrentPosition=r,this.audioFadingActive=l;t={name:"processUpdate",currentSample:this.audioCurrentPosition,sampleRate:this.audioSampleRate};this.sendEvent(t)}else for(p=0;p<o.numberOfChannels;++p)for(i=o.getChannelData(p),u=0;u<o.length;++u)i[u]=0},MushraAudioControl.prototype.setLoopStart=function(t){0<=t&&t<this.audioLoopEnd&&this.audioLoopEnd-t>=this.audioMinimumLoopDuration&&(this.audioLoopStart=t,this.audioCurrentPosition<this.audioLoopStart&&(this.audioCurrentPositionRequest=this.audioLoopStart),t={name:"loopStartChanged",start:this.audioLoopStart,end:this.audioLoopEnd},this.sendEvent(t))},MushraAudioControl.prototype.setLoopEnd=function(t){t<=this.audioMaxPosition&&t>this.audioLoopStart&&t-this.audioLoopStart>=this.audioMinimumLoopDuration&&(this.audioLoopEnd=t,this.audioCurrentPosition>this.audioLoopEnd&&(this.audioCurrentPositionRequest=this.audioLoopEnd),t={name:"loopEndChanged",start:this.audioLoopStart,end:this.audioLoopEnd},this.sendEvent(t))},MushraAudioControl.prototype.setLoop=function(t,e){var i=!1;0<=t&&t<this.audioLoopEnd&&e-t>=this.audioMinimumLoopDuration&&t!=this.audioLoopStart&&(this.audioLoopStart=t,this.audioCurrentPosition<this.audioLoopStart&&(this.audioCurrentPositionRequest=this.audioLoopStart),i=!0),e<=this.audioMaxPosition&&e>this.audioLoopStart&&e-t>=this.audioMinimumLoopDuration&&e!=this.audioLoopEnd&&(this.audioLoopEnd=e,this.audioCurrentPosition>this.audioLoopEnd&&(this.audioCurrentPositionRequest=this.audioLoopEnd),i=!0),1==i&&(i={name:"loopChanged",start:this.audioLoopStart,end:this.audioLoopEnd},this.sendEvent(i))},MushraAudioControl.prototype.setPosition=function(t,e){this.audioCurrentPositionRequest=t,e&&(t<this.audioLoopStart||t<=parseInt((this.audioLoopEnd+this.audioLoopStart)/2)?this.setLoopStart(t):(t>this.audioLoopEnd||t>parseInt((this.audioLoopEnd+this.audioLoopStart)/2))&&this.setLoopEnd(t));t={name:"processUpdate",currentSample:this.audioCurrentPositionRequest,sampleRate:this.audioSampleRate};this.sendEvent(t)},MushraAudioControl.prototype.getNumSamples=function(){return this.audioMaxPosition},MushraAudioControl.prototype.play=function(t,e){null===t&&(t=this.audioStimulus),this.audioStimulus===t&&e===this.audioIsReferencePlaying||null===this.audioStimulus||!1===this.audioPlaying?(this.audioStimulus=t,!1===this.audioPlaying&&this.fadeIn(t)):this.fadeOut(t),this.audioPlaying=!0},MushraAudioControl.prototype.getActiveStimulus=function(){return this.audioStimulus},MushraAudioControl.prototype.playReference=function(){this.play(this.reference,!0),this.audioIsReferencePlaying=!0;var t={name:"playReferenceTriggered",conditionLength:this.conditions.length};this.sendEvent(t)},MushraAudioControl.prototype.playCondition=function(t){this.play(this.conditions[t],!1),this.audioIsReferencePlaying=!1;t={name:"playConditionTriggered",index:t,length:this.conditions.length};this.sendEvent(t)},MushraAudioControl.prototype.fadeOut=function(t){this.audioFadingIn=t,this.audioFadingCurrentPositionRequest=0,this.audioFadingActiveRequest=1},MushraAudioControl.prototype.fadeIn=function(t){this.audioFadingIn=t,this.audioFadingCurrentPositionRequest=0,this.audioFadingActiveRequest=2},MushraAudioControl.prototype.pause=function(){!0===this.audioPlaying&&this.fadeOut(null);var t={name:"pauseTriggered",conditionLength:this.conditions.length};this.sendEvent(t)},MushraAudioControl.prototype.stop=function(){this.audioCurrentPositionRequest=this.audioLoopStart,!0===this.audioPlaying&&this.fadeOut(null);var t={name:"stopTriggered",conditionLength:this.conditions.length};this.sendEvent(t);t={name:"processUpdate",currentSample:this.audioCurrentPositionRequest,sampleRate:this.audioSampleRate};this.sendEvent(t)},MushraAudioControl.prototype.getConditions=function(){return this.conditions},MushraAudioControl.prototype.getReferenceIndexOfConditions=function(){var t=0;if(t<this.conditions.length)return this.conditions[t]===this.reference?t:null},DataSender.prototype.send=function(t){var e=JSON.stringify(t),i=new XMLHttpRequest;try{i.open("POST",config.remoteService,!1),i.setRequestHeader("Content-type","application/json"),i.send(e)}catch(t){return!0}t=JSON.parse(i.responseText);if(null!==t){if("error"in t)return this.errorHandler.sendError(t.error),!0;"pages"in t&&addPagesToPageManager(this.pageManager,t.pages,this.pageManager.getPageIndex()+1),"pagesIndex"in t&&(this.pageManager.pagesIndex=t.pagesIndex)}return 200!=i.status},ErrorHandler.prototype.sendError=function(t){this.errors[this.errors.length]=t,console.log("ERROR: "+t)},ErrorHandler.prototype.errorOccurred=function(){return 0<this.errors.length},ErrorHandler.prototype.displayErrors=function(){var t=$("<ul style='text-align:left;'></ul>");$("#popupErrorsContent").append(t);for(var e=0;e<this.errors.length;++e)t.append($("<li>"+this.errors[e]+"</li>"));$("#popupErrors").popup("open")},PageManager.prototype.addCallbackPageEventChanged=function(t){this.callbacksPageEventChanged[this.callbacksPageEventChanged.length]=t},PageManager.prototype.insertPage=function(t,e){this.pages.splice(e,0,t)},PageManager.prototype.getNextPage=function(){return this.pages[this.pagesIndex+1]},PageManager.prototype.getPageIndex=function(){return this.pagesIndex},PageManager.prototype.getNumPages=function(){return this.pages.length},PageManager.prototype.getPage=function(t){return this.pages[t]},PageManager.prototype.getCurrentPage=function(){return this.pages[this.pagesIndex]},PageManager.prototype.loadPage=function(){var t=this.parentElementId;$("#"+t).empty(),this.pages[this.pagesIndex].render($("#"+t)),this.pageEventChanged(),$("#"+t).append($("<script> "+this.getPageVariableName(this.getCurrentPage())+".load();<\/script>")),window.scrollTo(0,0),this.stopOnErrors&&this.errorHandler.errorOccurred()?this.errorHandler.displayErrors():$("body").children().children().removeClass("ui-disabled"),$.mobile.loading("hide")},PageManager.prototype.nextPage=function(){-1<this.pagesIndex&&(this.pages[this.pagesIndex].save(),this.pages[this.pagesIndex].store()),++this.pagesIndex,this.pagesIndex<this.pages.length?(this.pages[this.pagesIndex].init(),void 0!==this.pages[this.pagesIndex].loadAudioFiles?this.pages[this.pagesIndex].loadAudioFiles(this.loadPage.bind(this)):this.loadPage()):(--this.pagesIndex,this.stopOnErrors&&this.errorHandler.errorOccurred()&&this.errorHandler.displayErrors())},PageManager.prototype.previousPage=function(){var t;--this.pagesIndex,this.pagesIndex<=this.pages.length?(null!==this.pages[this.pagesIndex+1]&&null!==this.pages[this.pagesIndex+1].save&&this.pages[this.pagesIndex+1].save(),t=this.parentElementId,$("#"+t).empty(),this.pages[this.pagesIndex].render($("#"+t)),this.pageEventChanged(),$("#"+t).append($("<script> "+this.getPageVariableName(this.getCurrentPage())+".load();<\/script>")),window.scrollTo(0,0)):++this.pagesIndex},PageManager.prototype.start=function(){this.nextPage()},PageManager.prototype.restart=function(){this.pagesIndex=-1,this.start()},PageManager.prototype.getPageVariableName=function(t){for(var e=0;e<this.pages.length;++e)if(this.pages[e]==t)return this.varName+".pages["+e+"]";return!1},PageManager.prototype.getPageManagerVariableName=function(){return this.varName},PageManager.prototype.pageEventChanged=function(){for(var t=0;t<this.callbacksPageEventChanged.length;++t)this.callbacksPageEventChanged[t]()},PageManager.prototype.getLocalizer=function(){return this.localizer},PageTemplateRenderer.prototype.addCallbackEventRefreshed=function(t){this.callbacksEventRefreshed[this.callbacksEventRefreshed.length]=t},PageTemplateRenderer.prototype.eventRefreshed=function(){for(var t=0;t<this.callbacksEventRefreshed.length;++t)this.callbacksEventRefreshed[t]()},PageTemplateRenderer.prototype.renderProgressBar=function(t){this.progressbarId=t,TolitoProgressBar(this.progressbarId).setOuterTheme("a").setInnerTheme("b").isMini(!0).setMax(100).setStartFrom(0).setInterval(0).showCounter(!1).build()},PageTemplateRenderer.prototype.renderHeader=function(t){this.headerId=t,$("#"+this.headerId).append(this.pageManager.getCurrentPage().getName())},PageTemplateRenderer.prototype.renderNavigation=function(t){this.navigationId=t;var e,i=!1;0<this.pageManager.getPageIndex()&&this.showButtonPreviousPage&&this.pageManager.getPageIndex()<this.pageManager.getNumPages()-1&&(t=$("<button data-role='button' data-inline='true' onclick='"+this.pageManager.getPageManagerVariableName()+".previousPage();'>"+this.pageManager.getLocalizer().getFragment(this.language,"previousButton")+"</button>"),$("#"+this.navigationId).append(t),i=!0),(this.pageManager.getPageIndex()<this.pageManager.getNumPages()-1||![void 0,!1].includes(this.pageManager.pages[this.pageManager.getPageIndex()].pageConfig.send))&&(e=$("<button id='__button_next' data-role='button' data-inline='true' onclick='"+this.pageManager.getPageManagerVariableName()+".nextPage();'>"+this.pageManager.getLocalizer().getFragment(this.language,"nextButton")+"</button>"),this.lockNextButtonQueued&&e.attr("disabled","disabled"),Mousetrap.bind("enter",function(){e[0].hasAttribute("disabled")||e.click()}),$("#"+this.navigationId).append(e),i=!0),i||$("#"+this.navigationId).remove(),this.lockNextButtonQueued=!1},PageTemplateRenderer.prototype.lockNextButton=function(){0<$("#__button_next").length?$("#__button_next").attr("disabled","disabled"):this.lockNextButtonQueued=!0},PageTemplateRenderer.prototype.unlockNextButton=function(){$("#__button_next").removeAttr("disabled")},PageTemplateRenderer.prototype.refresh=function(){$("#"+this.progressbarId).progressbar("option","value",this.pageManager.getPageIndex()/(this.pageManager.getNumPages()-1)*100),$("#"+this.headerId).empty(),this.renderHeader(this.headerId),$("#"+this.navigationId).empty(),this.renderNavigation(this.navigationId),$.mobile.activePage&&$.mobile.activePage.trigger("create"),setTimeout(function(){this.eventRefreshed()}.bind(this),1)},PageTemplateRenderer.prototype.clear=function(){null!=this.headerId&&$("#"+this.headerId).empty(),null!=this.navigationId&&$("#"+this.navigationId).empty()},BS1116AudioControlInputController.prototype=Object.create(InputController.prototype),BS1116AudioControlInputController.prototype.constructor=BS1116AudioControlInputController,BS1116AudioControlInputController.prototype.bind=function(){var n=this.audioControl.getConditions();Mousetrap.bind(["r","0"],function(){$("#buttonReference").click()}),Mousetrap.bind(["backspace"],function(){$("#buttonStop").click()}),Mousetrap.bind(["space"],function(){for(var t=!1,e=0;e<n.length;e++){if("true"==$("#buttonConditions"+e).attr("active")){1!=this.audioControl.audioPlaying&&this.audioControl.setPosition(this.audioControl.audioLoopStart),$("#buttonConditions"+e).click(),t=!1;break}if("true"==$("#buttonReference").attr("active")){1!=this.audioControl.audioPlaying&&this.audioControl.setPosition(this.audioControl.audioLoopStart),$("#buttonReference").click(),t=!1;break}t=!0}1==t&&$("#buttonReference").click()}.bind(this));var t=this.audioControl.getDuration();for(this.looping&&(Mousetrap.bind(["a"],function(){this.pageManager.getCurrentPage().setLoopStart()}),Mousetrap.bind(["b"],function(){this.pageManager.getCurrentPage().setLoopEnd()}),Mousetrap.bind(["B"],function(){this.audioControl.setLoopEnd(t)}.bind(this)),Mousetrap.bind(["A"],function(){this.audioControl.setLoopStart(0)}.bind(this))),i=0;i<n.length;++i)!function(t){Mousetrap.bind(String(t+1),function(){$("#buttonConditions"+t).click()}),Mousetrap.bind(["l"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions0").click();else if("true"==$("#buttonConditions"+(n.length-1)).attr("active"))$("#buttonReference").click();else for(var t=0;t<n.length-1;++t)if("true"==$("#buttonConditions"+t).attr("active")){$("#buttonConditions"+(t+1)).click();break}}),Mousetrap.bind(["h"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions"+(n.length-1)).click();else if("true"==$("#buttonConditions0").attr("active"))$("#buttonReference").click();else for(var t=1;t<n.length;++t)if("true"==$("#buttonConditions"+t).attr("active")){$("#buttonConditions"+(t-1)).click();break}}),Mousetrap.bind(["up","j","shift+up","shift+j"],function(t,e){for(addVal=0,addVal=-1!=e.indexOf("shift")?1:.01,j=0;j<n.length;++j){var i=$(".scales").get(j);if("true"==$(i).attr("active")){var o=parseFloat($(i).val())+addVal;$(i).val(o.toString()),$(i).slider().slider("refresh");break}}return!1}),Mousetrap.bind(["down","k","shift+down","shift+k"],function(t,e){for(addVal=0,addVal=-1!=e.indexOf("shift")?1:.01,j=0;j<n.length;++j){var i=$(".scales").get(j);if("true"==$(i).attr("active")){var o=parseFloat($(i).val())-addVal;$(i).val(o.toString()),$(i).slider().slider("refresh");break}}return!1})}(i);Object.getPrototypeOf(BS1116AudioControlInputController.prototype).bind.call()},BS1116AudioControlInputController.prototype.unbind=function(){Object.getPrototypeOf(BS1116AudioControlInputController.prototype).unbind.call(),Mousetrap.unbind(["r","0","a","b","A","B","j","backspace","space","k","h","l"]);var t=this.audioControl.getConditions();for(i=0;i<t.length;++i)Mousetrap.unbind(String(i+1))},FilePlayerController.prototype=Object.create(InputController.prototype),FilePlayerController.prototype.constructor=FilePlayerController,FilePlayerController.prototype.bind=function(){var t=this.audioControl.getStimuli();for(i=0;i<t.length;++i)!function(t){Mousetrap.bind(String(t+1),function(){$("#playPause"+t).click()})}(i);Mousetrap.bind(["space"],function(t){$("#playPause0").click()}),Object.getPrototypeOf(FilePlayerController.prototype).bind.call(this)},FilePlayerController.prototype.unbind=function(){Object.getPrototypeOf(FilePlayerController.prototype).unbind.call(this);var t=this.audioControl.getStimuli();for(i=0;i<t.length;++i)Mousetrap.unbind(String(i+1));Mousetrap.unbind(["space"])},InputController.prototype.bind=function(){document.onkeydown=function(t){var e=(t=t||window.event).keyCode;return 8==e&&"TEXTAREA"!=(t.target||t.srcElement).tagName&&"INPUT"!=(t.target||t.srcElement).tagName||32==e&&"TEXTAREA"!=(t.target||t.srcElement).tagName&&"INPUT"!=(t.target||t.srcElement).tagName?(-1==navigator.userAgent.toLowerCase().indexOf("msie")?t.stopPropagation():(alert("prevented"),t.returnValue=!1),!1):void 0}},InputController.prototype.unbind=function(){},MushraAudioControlInputController.prototype=Object.create(InputController.prototype),MushraAudioControlInputController.prototype.constructor=MushraAudioControlInputController,MushraAudioControlInputController.prototype.bind=function(){var n=this.audioControl.getConditions();Mousetrap.bind(["r","0"],function(){$("#buttonReference").click()}),Mousetrap.bind(["backspace"],function(){$("#buttonStop").click()}),Mousetrap.bind(["space"],function(){for(var t=!1,e=0;e<n.length;e++){if("true"==$("#buttonConditions"+e).attr("active")){1!=this.audioControl.audioPlaying&&this.audioControl.setPosition(this.audioControl.audioLoopStart),$("#buttonConditions"+e).click(),t=!1;break}if("true"==$("#buttonReference").attr("active")){1!=this.audioControl.audioPlaying&&this.audioControl.setPosition(this.audioControl.audioLoopStart),$("#buttonReference").click(),t=!1;break}t=!0}1==t&&$("#buttonReference").click()}.bind(this));var t=this.audioControl.getDuration();for(this.looping&&(Mousetrap.bind(["a"],function(){this.pageManager.getCurrentPage().setLoopStart()}),Mousetrap.bind(["b"],function(){this.pageManager.getCurrentPage().setLoopEnd()}),Mousetrap.bind(["B"],function(){this.audioControl.setLoopEnd(t)}.bind(this)),Mousetrap.bind(["A"],function(){this.audioControl.setLoopStart(0)}.bind(this))),i=0;i<n.length;++i)!function(t){Mousetrap.bind(String(t+1),function(){$("#buttonConditions"+t).click()}),Mousetrap.bind(["l"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions0").click();else if("true"==$("#buttonConditions"+(n.length-1)).attr("active"))$("#buttonReference").click();else for(var t=0;t<n.length-1;++t)if("true"==$("#buttonConditions"+t).attr("active")){$("#buttonConditions"+(t+1)).click();break}}),Mousetrap.bind(["h"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions"+(n.length-1)).click();else if("true"==$("#buttonConditions0").attr("active"))$("#buttonReference").click();else for(var t=1;t<n.length;++t)if("true"==$("#buttonConditions"+t).attr("active")){$("#buttonConditions"+(t-1)).click();break}}),Mousetrap.bind(["up","j","shift+up","shift+j"],function(t,e){for(addVal=0,addVal=-1!=e.indexOf("shift")?10:1,j=0;j<n.length;++j){var i=$(".scales").get(j);if("true"==$(i).attr("active")){var o=parseInt($(i).val())+addVal;$(i).val(o.toString()),$(i).slider().slider("refresh");break}}return!1}),Mousetrap.bind(["down","k","shift+down","shift+k"],function(t,e){for(addVal=0,addVal=-1!=e.indexOf("shift")?10:1,j=0;j<n.length;++j){var i=$(".scales").get(j);if("true"==$(i).attr("active")){var o=parseInt($(i).val())-addVal;$(i).val(o.toString()),$(i).slider().slider("refresh");break}}return!1})}(i),Object.getPrototypeOf(MushraAudioControlInputController.prototype).bind.call();document.onkeydown=function(t){var e=(t=t||window.event).keyCode;return 8==e&&"TEXTAREA"!=(t.target||t.srcElement).tagName&&"INPUT"!=(t.target||t.srcElement).tagName||32==e&&"TEXTAREA"!=(t.target||t.srcElement).tagName&&"INPUT"!=(t.target||t.srcElement).tagName?(-1==navigator.userAgent.toLowerCase().indexOf("msie")?t.stopPropagation():(alert("prevented"),t.returnValue=!1),!1):void 0}},MushraAudioControlInputController.prototype.unbind=function(){Object.getPrototypeOf(MushraAudioControlInputController.prototype).unbind.call(),Mousetrap.unbind(["r","0","a","b","A","B","j","backspace","space","k","h","l","up","down"]);var t=this.audioControl.getConditions();for(i=0;i<t.length;++i)Mousetrap.unbind(String(i+1))},Session.prototype.getTrial=function(t,e){for(var i=0;i<this.trials.length;++i){var o=this.trials[i];if(o.type===t&&o.id===e)return o}return null},Stimulus.prototype.getId=function(){return this.id},Stimulus.prototype.getAudioBuffer=function(){return this.audioBuffer},Stimulus.prototype.setAudioBuffer=function(t){this.audioBuffer=t},Stimulus.prototype.getFilepath=function(){return this.filepath},FilePlayer.prototype.init=function(){if(this.genericAudioControl.initAudio(),1!=this.hideProgressBar)for(var t=0;t<this.stimuli.length;++t)TolitoProgressBar(this.progressBars[t].attr("id")).setOuterTheme("a").setInnerTheme("b").isMini(!0).setMax(100).setStartFrom(0).setInterval(0).showCounter(!1).build()},FilePlayer.prototype.free=function(){this.genericAudioControl.freeAudio()},FilePlayer.prototype.load=function(){},FilePlayer.prototype.renderElement=function(t,e){var i,o=$('<button data-role="button" id="playPause'+e+'" name="'+e+'"  class="audioControlElement">'+this.localizer.getFragment(this.language,"playButton")+"</button>");o.bind("click",function(t,e){var i=parseInt(t.target.name),t=$("#playPause"+i).text();if(t==this.localizer.getFragment(this.language,"playButton")){this.genericAudioControl.play(i),$("#playPause"+i).text(this.localizer.getFragment(this.language,"pauseButton"));for(var o=0;o<this.stimuli.length;++o)o!==i&&$("#playPause"+o).text(this.localizer.getFragment(this.language,"playButton"))}else t==this.localizer.getFragment(this.language,"pauseButton")&&(this.genericAudioControl.pause(),$("#playPause"+i).text(this.localizer.getFragment(this.language,"playButton")))}.bind(this)),1!=this.hideProgressBar&&(i=$('<div id = "'+("FilePlayer_progressbar_"+e)+'" class="fileplayer_progressbar" ></div>'),this.progressBars[e]=i),this.hooks[e]=$("<td></td>"),t.append($("<table></table>").append($("<tr></tr>").append($("<td></td>").append(o),$("<td></td>").append(i),this.hooks[e])))},FilePlayer.prototype.render=function(t){var e=$('<table align="center" class="default_padding"></table>');t.append(e);for(var i=0;i<this.stimuli.length;++i){var o=$("<tr></tr>");e.append(o);var n=$("<td></td>");this.renderElement(n,i),o.append(n)}},FilePlayer.prototype.getHook=function(t){return this.hooks[t]},FilePlayer.prototype.getStimuli=function(){return this.stimuli},LikertScale.prototype.enable=function(){$("input[name="+this.prefix+"_response]").checkboxradio("enable")},LikertScale.prototype.render=function(t){var e;if(this.group=$("<fieldset data-role='controlgroup' data-type='horizontal'></fieldset>"),t.append(this.group),this.elements=[],null!=this.responseConfig){for(e=0;e<this.responseConfig.length;++e){var i=this.responseConfig[e],o="";i.img&&(o="<img id='"+this.prefix+"_response_img_"+e+"' src='"+i.img+"'/><br/>");o=$("<input type='radio' data-mini='false' value='"+i.value+"' name='"+this.prefix+"_response' id='"+this.prefix+"_response_"+e+"'/>         <label for='"+this.prefix+"_response_"+e+"'><center>"+o+i.label+"</center></label>       ");this.elements[this.elements.length]=o,this.group.append(o),void 0!==i.shortcut&&function(e){Mousetrap.bind(i.shortcut,function(t){e.click()})}(o)}this.group.change(function(){var t=!1;for(e=0;e<this.elements.length;++e)!0===t?$("#"+this.prefix+"_response_img_"+e).attr("src",this.responseConfig[e].img):$("#"+this.prefix+"_response_"+e+":checked").val()?(t=!0,$("#"+this.prefix+"_response_img_"+e).attr("src",this.responseConfig[e].imgSelected)):$("#"+this.prefix+"_response_img_"+e).attr("src",this.responseConfig[e].imgHigherResponseSelected);this.callback&&this.callback(this.prefix)}.bind(this))}this.initDisabled&&this.group.children().attr("disabled","disabled")},Localizer.prototype.initializeNLSFragments=function(t){this.nlsFragments=t},Localizer.prototype.addFragment=function(t,e,i){this.nlsFragments[t]||(this.nlsFragments[t]=new Object),this.nlsFragments[t][e]=i},Localizer.prototype.getFragment=function(t,e){return this.nlsFragments[t][e]},Localizer.prototype.checkLocalization=function(){var t,e=null;for(t in this.nlsFragments)if(null==e&&(e=t.length),e!=t.length)return!1;return!0},MushraValidator.prototype.checkSamplerate=function(t,e){return t==e.getAudioBuffer().sampleRate||(this.errorHandler.sendError("Sample rate of device and stimulus ("+e.getId()+" is different."),!1)},MushraValidator.prototype.checkNumChannels=function(t,e){return!(t.destination.channelCount<e.getAudioBuffer().numberOfChannels)||(this.errorHandler.sendError("Audio device has not enough channels ("+t.destination.channelCount+") for playing back stimulus "+e.getId()+" ("+e.getAudioBuffer().numberOfChannels+")."),!1)},MushraValidator.prototype.checkNumConditions=function(t){return!(12<t.length)||(this.errorHandler.sendError("Number of conditions must be no more than 12."),!1)},MushraValidator.prototype.checkStimulusDuration=function(t){return!(12<t.getAudioBuffer().duration)||(this.errorHandler.sendError("Duration of stimulus ("+t.getId()+") must not exceed 12s."),!1)},MushraValidator.prototype.checkConditionConsistency=function(t,e){for(var i=t.getAudioBuffer().sampleRate,o=t.getAudioBuffer().length,n=t.getAudioBuffer().numberOfChannels,s=!0,a=0;a<e.length;++a)i!=e[a].getAudioBuffer().sampleRate&&(this.errorHandler.sendError("Reference/Conditions have different sample rates."),s=!1),o!=e[a].getAudioBuffer().length&&(this.errorHandler.sendError("Reference/Conditions have different (sample) lengths."),s=!1),n!=e[a].getAudioBuffer().numberOfChannels&&(this.errorHandler.sendError("Reference/Conditions have different numbers of channels."),s=!1);return s},WaveformVisualizer.prototype.translateOrigToResampled=function(t){return Number.parseInt(this.resampledSamples.length/this.avgOriginalSamples.length*t)},WaveformVisualizer.prototype.resample=function(){if(this.resampledSamples=[],0==this.showWaveform)for(var t=0;t<this.canvas.width;t++)this.resampledSamples[t]=.3;else for(var e=Math.ceil(this.avgOriginalSamples.length/this.canvas.width),i=0,o=0;o<this.avgOriginalSamples.length;o+=e){for(var n=0,s=0;s<e;s++)n+=Math.abs(this.avgOriginalSamples[s+o]);var a=Math.abs(n*(1/e));this.resampledSamples[i]=a,i++}this.currentPosition=0,this.leftRegionPosition=0,this.rightRegionPosition=this.resampledSamples.length},WaveformVisualizer.prototype.scaleToHeight=function(){var t=0;if((this.scaledToHeight=0)==this.showWaveform)t=this.resampledSamples[0],this.scaledToHeight=this.canvas.height/t;else{for(var e=0;e<this.resampledSamples.length;e++)t<this.resampledSamples[e]&&(t=this.resampledSamples[e]);this.scaledToHeight=this.canvas.height/t}},WaveformVisualizer.prototype.renderSlider=function(){this.parentSlider.append(this.slider),$.mobile.activePage.trigger("create"),noUiSlider.create(this.slider.get(0),{connect:!0,range:{min:0,max:this.stimulus.audioBuffer.length},start:[0,this.stimulus.audioBuffer.length],step:1,margin:25e3});var n=this.stimulus.audioBuffer.sampleRate;this.slider.get(0).noUiSlider.on("update",function(t,e){var i=Math.floor(t[0]/n*100)/100,o=Math.floor(t[1]/n*100)/100;$("#lowerLim").val(i.toFixed(2)),$("#upperLim").val(o.toFixed(2));o=parseInt(t[0]),t=parseInt(t[1]);this.mushraAudioControl.setLoop(o,t),t<this.currentPosition/this.scale&&this.mushraAudioControl.setPosition(parseInt(this.rightRegionPosition/this.scale))}.bind(this))},WaveformVisualizer.prototype.renderTable=function(){var t=$("<tr valign='bottom'></tr>");this.table.append(t);var e=$("<td id='sliderLim'></td>"),i=$("<td></td>"),o=$("<td id='sliderLim'></td>");t.append(e),t.append(i),t.append(o);t=$("     <td>     </td>   ");t.append(this.parentWavesurfer),t.append(this.parentSlider),i.append(t),t.css("width",i.width().toString());t=$('<div id=\'div_lower_limit\'><input type="text" name="name" id="lowerLim" class="limits" data-inline="true" data-mini="true"disabled="disabled"></input></div>'),i=$('<div id=\'div_upper_limit\'><input type="text" name="name" id="upperLim" class="limits" data-inline="true" data-mini="true"disabled="disabled"></input></div>');e.append(t),o.append(i)},WaveformVisualizer.prototype.create=function(){this.enableLooping&&(this.renderTable(),this.renderSlider()),this.canvas.style.left=this.parent.get(0).style.left,this.canvas.style.top=this.parent.get(0).style.top,this.canvas.style.position="relative",this.canvas.style.zIndex=0,this.canvas.setAttribute("id","canvas"),this.parentWavesurfer.append(this.canvas),this.canvas.height=this.parentWavesurfer.height(),this.canvas.width=this.parentWavesurfer.width(),this.scale=this.canvas.offsetWidth/this.resampledSamples.length,this.resample(),this.scaleToHeight(),this.regionStart=0,this.regionWidth=this.canvas.offsetWidth,this.canvas.addEventListener("click",function(t){t=null!=t.x?this.calculateRegion(t.x):this.calculateRegion(t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft),this.enableLooping?this.leftRegionPosition!=t.left?this.mushraAudioControl.setLoopStart(parseInt(t.left/this.scale)):this.rightRegionPosition!=t.right&&this.mushraAudioControl.setLoopEnd(parseInt(t.right/this.scale+t.left/this.scale)):this.leftRegionPosition!=t.left?this.mushraAudioControl.setPosition(parseInt(t.left/this.scale)):this.rightRegionPosition!=t.right&&this.mushraAudioControl.setPosition(parseInt(t.right/this.scale+t.left/this.scale))}.bind(this)),this.refresh()},WaveformVisualizer.prototype.draw=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(0,this.canvas.height/2),this.context.fillStyle="rgba(0, 0, 0, 0.1)",this.context.fillRect(this.leftRegionPosition,-1*this.canvas.height/2,this.rightRegionPosition-this.leftRegionPosition,2*this.canvas.height);var t=0<this.leftRegionPosition||this.rightRegionPosition<this.resampledSamples.length,e=0;this.context.beginPath(),t?this.context.strokeStyle="#808080":e=0!=this.currentPosition?0:(this.context.strokeStyle="#F8DEBD",1);for(var i=0;i<this.resampledSamples.length;i++)0==e&&i>=this.leftRegionPosition?(this.context.stroke(),this.context.beginPath(),this.context.strokeStyle="#ED8C01",e=1):1==e&&i>this.currentPosition?(this.context.stroke(),this.context.beginPath(),this.context.strokeStyle="#F8DEBD",e=2):2==e&&i>this.rightRegionPosition&&(this.context.stroke(),this.context.beginPath(),this.context.strokeStyle="#808080",e=3),this.context.moveTo(i,-1*this.resampledSamples[i]*this.scaledToHeight/2),this.context.lineTo(i,this.resampledSamples[i]*this.scaledToHeight/2);this.context.stroke(),this.context.translate(0,-this.canvas.height/2)},WaveformVisualizer.prototype.refresh=function(){this.draw()},WaveformVisualizer.prototype.setWidth=function(t){this.canvas.width=t,this.resample(),this.scaleToHeight(),this.refresh()},WaveformVisualizer.prototype.setHeight=function(t){this.canvas.height=t,this.resample(),this.scaleToHeight(),this.refresh()},WaveformVisualizer.prototype.calculateRegion=function(t){var e={left:this.leftRegionPosition,right:this.rightRegionPosition},t=t-(this.canvas.offsetLeft+this.canvas.offsetParent.offsetLeft);return t<this.leftRegionPosition+(this.rightRegionPosition-this.leftRegionPosition)/2?(e.left=t,e.right=this.rightRegionPosition-this.leftRegionPosition):(e.left=this.leftRegionPosition,e.right=t-this.leftRegionPosition),e},WaveformVisualizer.prototype.setLeftRegionPosition=function(t){this.leftRegionPosition=this.translateOrigToResampled(t)},WaveformVisualizer.prototype.setRightRegionPosition=function(t){this.rightRegionPosition=this.translateOrigToResampled(t)},WaveformVisualizer.prototype.setCurrentPosition=function(t){this.currentPosition=this.translateOrigToResampled(t),this.currentPosition<this.leftRegionPosition&&(this.currentPosition=this.leftRegionPosition),this.currentPosition>this.rightRegionPosition&&(this.currentPosition=this.rightRegionPosition),this.draw()},WaveformVisualizer.prototype.load=function(){$("#upperLim").parent().css("opacity","1"),$("#lowerLim").parent().css("opacity","1"),$("#div_lower_limit").css("opacity","1"),$("#div_upper_limit").css("opacity","1")},nls.en=new Object,nls.de=new Object,nls.fr=new Object,nls.en.nextButton="Next",nls.en.previousButton="Previous",nls.en.playButton="Play",nls.en.stopButton="Stop",nls.en.pauseButton="Pause",nls.en.sendButton="Send Results",nls.de.nextButton="Nchste Seite",nls.de.previousButton="Vorherige Seite",nls.de.playButton="Start",nls.de.stopButton="Stopp",nls.de.pauseButton="Pause",nls.de.sendButton="Ergebnisse senden",nls.fr.nextButton="Suivant",nls.fr.previousButton="Prcdent",nls.fr.playButton="Play",nls.fr.stopButton="Stop",nls.fr.pauseButton="Pause",nls.fr.sendButton="Envoyer les rsultats",nls.en.excellent="Excellent",nls.en.good="Good",nls.en.fair="Fair",nls.en.poor="Poor",nls.en.bad="Bad",nls.en.reference="Reference",nls.en.cond="Cond.",nls.en[35]="Anchor35",nls.en[75]="Anchor75",nls.de.excellent="Excellent",nls.de.good="Good",nls.de.fair="Fair",nls.de.poor="Poor",nls.de.bad="Bad",nls.de.reference="Reference",nls.de.cond="Cond.",nls.de[35]="Anchor35",nls.de[75]="Anchor75",nls.fr.excellent="Excellent",nls.fr.good="Bien",nls.fr.fair="Correct",nls.fr.poor="Faible",nls.fr.bad="Mauvais",nls.fr.reference="Rfrence",nls.fr.cond="Cond.",nls.fr[35]="Ancre35",nls.fr[75]="Ancre75",nls.en.imperceptible="Imperceptible",nls.en.perceptible="Perceptible, but not annoying",nls.en.slightly="Slightly annoying",nls.en.annoying="Annoying",nls.en.very="Very annoying",nls.de.imperceptible="Imperceptible",nls.de.perceptible="Perceptible, but not annoying",nls.de.slightly="Slightly annoying",nls.de.annoying="Annoying",nls.de.very="Very annoying",nls.fr.imperceptible="Dgradation imperceptible",nls.fr.perceptible="Perceptible, mais non gnante",nls.fr.slightly="Lgrement gnante",nls.fr.annoying="Dgradation gnante",nls.fr.very="Dgradation trs gnante",nls.en.quest="Which item is the reference?",nls.de.quest="Welches Stck ist die Referenz?",nls.fr.quest="Quel item est la rfrence?",nls.en.results="Your results:",nls.de.results="Die Ergebnisse:",nls.fr.results="Vos rsultats:",nls.en.attending="Thank you for your participation!",nls.de.attending="Vielen Dank fr die Teilnahme!",nls.fr.attending="Merci pour votre participation!",AudioPage.prototype=Object.create(Page.prototype),AudioPage.prototype.constructor=AudioPage,AudioPage.prototype.addAudioFile=function(t,e){this.audioFiles[t]=e},AudioPage.prototype.loadAudioFiles=function(t){for(var e in this.audioFiles)this.audioFileLoader.addFile(e,function(t,e){e.setAudioBuffer(t)},this.audioFiles[e]);this.audioFileLoader.startLoading(t)},BS1116Page.prototype=Object.create(AudioPage.prototype),BS1116Page.prototype.constructor=BS1116Page,BS1116Page.prototype.init=function(){Object.getPrototypeOf(BS1116Page.prototype).init.call(this),this.mushraAudioControl=new MushraAudioControl(this.audioContext,this.bufferSize,this.reference,[this.condition],this.errorHandler,!1,!1),this.mushraAudioControl.addEventListener(function(t){"stopTriggered"==t.name&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating0").slider("disable"),$("#rating0").attr("active","false"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating1").slider("disable"),$("#rating1").attr("active","false"),$("#buttonConditions1").attr("active","false")),$.mobile.activePage.find("#buttonStop").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonStop").focus(),$("#buttonStop").attr("active","true"))}.bind(this))},BS1116Page.prototype.render=function(t){var e=$("<div></div>");t.append(e),n=null===this.pageConfig.content?"":this.pageConfig.content;var i=$("<p>"+n+"</p>");e.append(i);var o=$("<table id='main' align='center'></table>");e.append(o);var n=$("<tr id='trWs'></tr>");o.append(n);i=$("     <td class='stopButton' id='tdStopButton'>       <button data-role='button' data-inline='true' id='buttonStop' class='center' onclick='"+this.pageManager.getPageVariableName(this)+".mushraAudioControl.stop();'>"+this.pageManager.getLocalizer().getFragment(this.language,"stopButton")+"</button>     </td>   ");n.append(i);e=$("<td></td>");n.append(e),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",e,this.reference,this.pageConfig.showWaveform,this.pageConfig.enableLooping,this.mushraAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load();i=$("<tr></tr>"),n=$("<td id='td_Mushra' colspan='2'></td>");i.append(n),o.append(i);e=$("<table id='tableBS1116'></table>"),o=$("<tr><td>A ("+this.pageManager.getLocalizer().getFragment(this.language,"reference")+") </td><td></td><td>B</td><td>C</td></tr>");e.append(o);i=$("<tr></tr>"),o=$("<td id='tdPlayButton' ><button data-theme='a' id='buttonReference' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackReference()' >"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");i.append(o);o=$("<td id='BS1116conditionNameScale'></td>");i.append(o);o=$("<td><button data-theme='a' id='buttonConditions0' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackB()' >"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");i.append(o);o=$("<td><button data-theme='a' id='buttonConditions1' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackC()' >"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");i.append(o),e.append(i);var s=$("<tr id='tr_ConditionRatings'></tr>");e.append(s);i=$("<td id='refCanvas'></td>");s.append(i);i=$("<td id='spaceForScale'></td>");s.append(i);for(var a=0;a<2;++a){var r=$("<td class='spaceForSlider'>       <span><input type='range'  class='scales' id='rating"+a+"' value='5' min='1' max='5' step='0.01' data-vertical='true' data-highlight='true' style='display : inline-block; float : none;'/></span>     </td>");$(".ui-slider-handle").unbind("keydown"),s.append(r)}n.append(e),Object.getPrototypeOf(BS1116Page.prototype).render.call(this,t),this.bacic=new BS1116AudioControlInputController(this.mushraAudioControl,this.pageConfig.enableLooping),this.bacic.bind()},BS1116Page.prototype.pause=function(){this.mushraAudioControl.pause()},BS1116Page.prototype.setLoopStart=function(){var t=document.getElementById("slider"),e=this.mushraAudioControl.audioCurrentPosition,t=parseFloat(t.noUiSlider.get()[1]);this.mushraAudioControl.setLoop(e,t)},BS1116Page.prototype.setLoopEnd=function(){var t=document.getElementById("slider"),e=parseFloat(t.noUiSlider.get()[0]),t=this.mushraAudioControl.audioCurrentPosition;this.mushraAudioControl.setLoop(e,t)},BS1116Page.prototype.renderCanvas=function(t){parent=$("#"+t);t=document.createElement("canvas");t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.zIndex=0,t.setAttribute("id","BS116canvas"),parent.get(0).appendChild(t),$("#BS116canvas").offset({top:$("#refCanvas").offset().top,left:$("#refCanvas").offset().left}),t.height=parent.get(0).offsetHeight-(parent.get(0).offsetHeight-$("#tr_ConditionRatings").height()),t.width=parent.get(0).offsetWidth,$(".scales").siblings().css("zIndex","1"),$(".scales").slider("disable");var i=t.getContext("2d"),t=$(".scales").prev().offset().top-$(".scales").parent().offset().top,o=$(".scales").parent().get(0).offsetTop+parseInt($(".scales").css("borderTopWidth"),10)+t,n=$(".scales").prev().height(),e=$("#spaceForScale").offset().left-$("#spaceForScale").parent().offset().left+1.5*i.measureText("Perceptible, but not annoying    4").width,s=-$("#tableBS1116").offset().left-($("#BS116canvas").offset().left-$("#tableBS1116").offset().left),a=$(".scales").first().prev().children().eq(0).offset().left+s,t=$(".scales").last().offset().left-$("#tableBS1116").offset().left+$(".scales").last().width()/2;i.beginPath(),i.lineWidth="1.5",i.moveTo(e,o),i.lineTo(t,o),i.stroke();for(var r=[.25,.5,.75],l=0;l<r.length;++l){i.beginPath(),i.lineWidth="1.5",i.moveTo(e,n*r[l]+o),i.lineTo(a,n*r[l]+o),i.stroke();var h=null;$(".scales").each(function(t){var e=$(this).prev().first();0<t&&(i.beginPath(),i.lineWidth="1.5",i.moveTo(h,n*r[l]+o),i.lineTo(e.offset().left+s,n*r[l]+o),i.stroke()),h=e.offset().left+e.width()+s+1})}i.beginPath(),i.moveTo(e,n+o),i.lineTo(t,n+o),i.stroke(),i.font="1.25em Calibri",i.textBaseline="middle",i.textAlign="center";$("#refCanvas").width(),$("#spaceForScale").width(),i.measureText("Perceptible, but not annoying    4 ").width;i.font="1em Calibri",i.textAlign="right";t=e-.25*i.measureText("Perceptible, but not annoying    4").width;i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"imperceptible")+"    5",t,o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"perceptible")+"    4",t,.25*n+o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"slightly")+"    3",t,.5*n+o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"annoying")+"    2",t,.75*n+o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"very")+"    1",t,n+o)},BS1116Page.prototype.cleanButtons=function(){"true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating0").slider("disable"),$("#rating0").attr("active","false"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating1").slider("disable"),$("#rating1").attr("active","false"),$("#buttonConditions1").attr("active","false"))},BS1116Page.prototype.btnCallbackReference=function(){this.currentItem="ref";var t=$("#buttonReference").text();t==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):t==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playReference(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonReference").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonReference").focus(),$("#buttonReference").attr("active","true"))},BS1116Page.prototype.btnCallbackB=function(){this.currentItem="B";var t=$("#buttonConditions0").text();t==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):t==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(0),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#rating0").slider("enable"),$("#rating0").attr("active","true"),$("#buttonConditions0").focus(),$("#buttonConditions0").attr("active","true"))},BS1116Page.prototype.btnCallbackC=function(){this.currentItem="C";var t=$("#buttonConditions1").text();t==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):t==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(1),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#rating1").slider("enable"),$("#rating1").attr("active","true"),$("#buttonConditions1").focus(),$("#buttonConditions1").attr("active","true"))},BS1116Page.prototype.load=function(){if(Object.getPrototypeOf(BS1116Page.prototype).load.call(this),this.startTimeOnPage=new Date,this.renderCanvas("tableBS1116"),0!==this.ratings.length)for(var t=$(".scales"),e=0;e<t.length;++e)$(".scales").eq(e).val(this.ratings[e].value).slider("refresh");this.mushraAudioControl.initAudio();this.loop.start,this.waveformVisualizer.stimulus.audioBuffer.sampleRate,this.loop.end,this.waveformVisualizer.stimulus.audioBuffer.sampleRate;null!==this.loop.start&&null!==this.loop.end&&(this.mushraAudioControl.setLoop(0,0,this.mushraAudioControl.getDuration(),this.mushraAudioControl.getDuration()/this.waveformVisualizer.stimulus.audioBuffer.sampleRate),this.mushraAudioControl.setPosition(0))},BS1116Page.prototype.save=function(){Object.getPrototypeOf(BS1116Page.prototype).save.call(this),this.bacic.unbind(),this.time+=new Date-this.startTimeOnPage,this.mushraAudioControl.removeEventListener(this.waveformVisualizer.numberEventListener),this.mushraAudioControl.freeAudio();var t=$(".scales");this.ratings=[];for(var e=0;e<t.length;++e)this.ratings[e]={name:t[e].name,value:t[e].value};this.loop.start=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopStart),this.loop.end=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopEnd)},BS1116Page.prototype.store=function(){var t=this.session.getTrial(this.pageConfig.type,this.pageConfig.id);null===t&&((t=new Trial).type=this.pageConfig.type,t.id=this.pageConfig.id,this.session.trials[this.session.trials.length]=t);var e=new BS1116Rating;e.reference=this.reference.getId(),e.nonReference=this.condition.getId(),0===this.mushraAudioControl.getReferenceIndexOfConditions()?(e.referenceScore=this.ratings[0].value,e.nonReferenceScore=this.ratings[1].value):(e.nonReferenceScore=this.ratings[0].value,e.referenceScore=this.ratings[1].value),e.time=this.time,t.responses[t.responses.length]=e,Object.getPrototypeOf(BS1116Page.prototype).store.call(this,e,this.session.trials)},BS1116PageManager.prototype.createPages=function(t,e,i,o,n,s,a,r,l,h,p){for(var u in stimuli=[],i.stimuli)stimuli[stimuli.length]=new Stimulus(u,i.stimuli[u]);var d=new Stimulus("reference",i.reference);shuffle(stimuli);for(var g=0;g<stimuli.length;++g){var c=new BS1116Page(t,e,i,o,n,s,a,r,l,h,d,stimuli[g]);t.insertPage(c,p),++p}return p},FilePlayerPage.prototype=Object.create(AudioPage.prototype),FilePlayerPage.prototype.constructor=FilePlayerPage,FilePlayerPage.prototype.init=function(t,e){Object.getPrototypeOf(FilePlayerPage.prototype).init.call(this),this.filePlayer=new FilePlayer(this.audioContext,this.bufferSize,t,this.errorHandler,this.language,this.pageManager.getLocalizer(),e)},FilePlayerPage.prototype.load=function(t){Object.getPrototypeOf(FilePlayerPage.prototype).load.call(this,t),this.filePlayer.init()},FilePlayerPage.prototype.save=function(){Object.getPrototypeOf(FilePlayerPage.prototype).save.call(this),this.inputController.unbind(),this.filePlayer.free()},FilePlayerPage.prototype.render=function(t){this.filePlayer.render(t),this.inputController=new FilePlayerController(this.filePlayer),this.inputController.bind(),Object.getPrototypeOf(FilePlayerPage.prototype).render.call(this,t)},FinishPage.prototype=Object.create(Page.prototype),FinishPage.prototype.constructor=FinishPage,FinishPage.prototype.render=function(t){t.append(this.pageConfig.content),Object.getPrototypeOf(FinishPage.prototype).render.call(this,t);var e=$("<button id='send_results' data-role='button' data-inline='true'>"+this.pageManager.getLocalizer().getFragment(this.language,"sendButton")+"</button>");e.bind("click",function(t,e){Object.getPrototypeOf(FinishPage.prototype).save.call(this),Object.getPrototypeOf(FinishPage.prototype).store.call(this,this.session.participant),!this.pageConfig.send&&void 0!==this.pageConfig.send||(this.sendError=this.dataSender.send(this.session),1==this.sendError&&this.errorDiv.text("An error occured while sending your data to the server! Please contact the experimenter.")),$("#popupDialog").popup("open")}.bind(this)),t.append(e),Mousetrap.bind("enter",function(){e[0].hasAttribute("disabled")||e.click()}),$("#popHeader").text(this.pageManager.getLocalizer().getFragment(this.language,"attending"));var o,n,s,a,r,l=$("<table align='center'> </table>"),h=document.createElement("tr"),t=$("<th colspan='2' align='center'> </th>");if($(t).append(this.pageConfig.popupContent),$(l).append(t),$(l).append(h),this.pageConfig.showResults){th=$("<th colspan='3'> </th>"),$(th).append($("<h3>"+this.pageManager.getLocalizer().getFragment(this.language,"results")+"</h3>")),$(h).append(th);var p=this.session.trials;for(i=0;i<p.length;++i){var u=p[i];if("mushra"===u.type){o=document.createElement("tr"),s=$("<th colspan='2'></th>"),$(s).append(u.id+" (MUSHRA)"),$(o).append(s),$(l).append(o);for(var d=u.responses,g=0;g<d.length;++g){n=document.createElement("tr"),a=document.createElement("td"),r=document.createElement("td"),a.width="50%",r.width="50%";var c=d[g];$(a).append(c.stimulus+": "),$(r).append(c.score),$(n).append(a),$(n).append(r),$(l).append(n)}trEmpty=$("<tr height='8px'></tr>"),$(l).append(trEmpty)}else if("paired_comparison"===u.type){for(trPaired=document.createElement("tr"),s=$("<th colspan='2'></th>"),$(s).append(u.id+" (Paired Comparison)"),$(trPaired).append(s),$(l).append(trPaired),g=0;g<u.responses.length;++g){trPC=document.createElement("tr"),tdPCReference=document.createElement("td"),tdPCres=document.createElement("td");var f=u.responses[g];$(tdPCres).append(f.answer),$(tdPCReference).append(f.nonReference),$(trPC).append(tdPCReference),$(trPC).append(tdPCres),$(l).append(trPC)}trEmpty=$("<tr height='8px'></tr>"),$(l).append(trEmpty)}else if("bs1116"===u.type){for(trPaired=document.createElement("tr"),s=$("<th colspan='2'></th>"),$(s).append(u.id+" (BS1116)"),$(trPaired).append(s),$(l).append(trPaired),g=0;g<u.responses.length;++g){f=u.responses[g];trBS1=document.createElement("tr"),trBS2=document.createElement("tr"),tdBSReference=document.createElement("td"),tdBSRefValue=document.createElement("td"),tdBSCondition=document.createElement("td"),tdBSConValue=document.createElement("td"),$(tdBSReference).append(f.reference+": "),$(tdBSRefValue).append(f.referenceScore),$(trBS1).append(tdBSReference),$(trBS1).append(tdBSRefValue),$(tdBSCondition).append(f.nonReference+": "),$(tdBSConValue).append(f.nonReferenceScore),$(trBS2).append(tdBSCondition),$(trBS2).append(tdBSConValue),trEmpty=$("<tr height='5px'></tr>"),$(l).append(trBS1),$(l).append(trBS2),$(l).append(trEmpty)}trEmpty=$("<tr height='3px'></tr>"),$(l).append(trEmpty)}else if("likert_multi_stimulus"===u.type)for(trLMSH=document.createElement("tr"),s=$("<th colspan='2'></th>"),$(s).append(u.id+" (LMS)"),$(trLMSH).append(s),$(l).append(trLMSH),g=0;g<u.responses.length;++g){trLMS=document.createElement("tr"),tdStimulus=document.createElement("td"),tdRating=document.createElement("td"),$(tdStimulus).append(u.responses[g].stimulus+": ");var m=[];for(b in u.responses[g].stimulusRating)m.push(u.responses[g].stimulusRating[b]);$(tdRating).append(m.join(", ")),$(trLMS).append(tdStimulus),$(trLMS).append(tdRating),$(l).append(trLMS)}else if("likert_single_stimulus"===u.type)for(trLSSH=document.createElement("tr"),s=$("<th colspan='2'></th>"),$(s).append(u.id+" (LSS)"),$(trLSSH).append(s),$(l).append(trLSSH),g=0;g<u.responses.length;++g){trLSS=document.createElement("tr"),tdStimuli=document.createElement("td"),tdRating=document.createElement("td"),$(tdStimuli).append(u.responses[g].stimulus+": ");var b,m=[];for(b in u.responses[g].stimulusRating)m.push(u.responses[g].stimulusRating[b]);$(tdRating).append(m.join(", ")),$(trLSS).append(tdStimuli),$(trLSS).append(tdRating),$(l).append(trLSS)}}}1==this.pageConfig.showErrors&&$("#popupResultsContent").append(this.errorDiv),$("#popupResultsContent").append(l)},FinishPage.prototype.load=function(){$("#labeltd").css("padding-top",$("#feedback").css("margin-top")),Object.getPrototypeOf(FinishPage.prototype).load.call(this)},GenericPage.prototype=Object.create(Page.prototype),GenericPage.prototype.constructor=GenericPage,GenericPage.prototype.render=function(t){t.append(this.pageConfig.content),Object.getPrototypeOf(GenericPage.prototype).render.call(this,t)},GenericPage.prototype.store=function(){Object.getPrototypeOf(GenericPage.prototype).store.call(this,this.session.participant,this.session.participant)},LikertMultiStimulusPage.prototype=Object.create(FilePlayerPage.prototype),LikertMultiStimulusPage.prototype.constructor=LikertMultiStimulusPage,LikertMultiStimulusPage.prototype.init=function(t){Object.getPrototypeOf(LikertMultiStimulusPage.prototype).init.call(this,this.stimuli,!1);for(var e=0;e<this.stimuli.length;++e){this.stimulusResponses[e]={};for(var i=0;i<this.pageConfig.stimulusQuestionnaire.length;++i){var o,n=this.pageConfig.stimulusQuestionnaire[i];"likert"===n.type&&(o=e+"_"+n.name,this.likertObjects[o]=new LikertScale(n.response,o,this.pageConfig.mustPlayback))}}this.pageConfig.mustPlayback&&this.filePlayer.genericAudioControl.addEventListener(function(t){t.name==this.pageConfig.mustPlayback&&(this.enableQuestionnaire(this.pageConfig.stimulusQuestionnaire,t.index+"_"),this.enableQuestionnaire(this.pageConfig.questionnaire))}.bind(this))},LikertMultiStimulusPage.prototype.render=function(t){var e=$("<div></div>");t.append(e),i=null===this.pageConfig.content?"":this.pageConfig.content;var i=$("<p>"+i+"</p>");e.append(i),Object.getPrototypeOf(LikertMultiStimulusPage.prototype).render.call(this,t);for(var o=0;o<this.stimuli.length;++o){var n=this.renderQuestionnaire(this.pageConfig.stimulusQuestionnaire,o+"_");this.filePlayer.getHook(o).append(n)}},LikertMultiStimulusPage.prototype.load=function(){this.startTimeOnPage=new Date;for(var t=[],e=0;e<this.stimuli.length;++e)this.restoreQuestionnaire(this.pageConfig.stimulusQuestionnaire,this.stimulusResponses[e],e+"_"),t[t.length]=[this.pageConfig.stimulusQuestionnaire,e+"_"];Object.getPrototypeOf(LikertMultiStimulusPage.prototype).load.call(this,t)},LikertMultiStimulusPage.prototype.save=function(){Object.getPrototypeOf(LikertMultiStimulusPage.prototype).save.call(this),this.time+=new Date-this.startTimeOnPage;for(var t=0;t<this.stimuli.length;++t)this.readQuestionnaire(this.pageConfig.stimulusQuestionnaire,this.stimulusResponses[t],t+"_")},LikertMultiStimulusPage.prototype.store=function(){trial=new Trial,trial.type=this.pageConfig.type,trial.id=this.pageConfig.id;for(var t=0;t<this.stimuli.length;++t){var e=new LikertResponse;e.stimulus=this.stimuli[t].id,e.stimulusRating=this.stimulusResponses[t],e.time=this.time,trial.responses[trial.responses.length]=e}this.session.trials[this.session.trials.length]=trial,Object.getPrototypeOf(LikertMultiStimulusPage.prototype).store.call(this,trial,this.session.trials)},LikertSingleStimulusPage.prototype=Object.create(FilePlayerPage.prototype),LikertSingleStimulusPage.prototype.constructor=LikertSingleStimulusPage,LikertSingleStimulusPage.prototype.init=function(){Object.getPrototypeOf(LikertSingleStimulusPage.prototype).init.call(this,[this.stimulus],this.pageConfig.showWaveform),this.pageConfig.mustPlayback&&this.filePlayer.genericAudioControl.addEventListener(function(t){t.name==this.pageConfig.mustPlayback&&this.enableQuestionnaire(this.pageConfig.questionnaire)}.bind(this))},LikertSingleStimulusPage.prototype.render=function(t){var e=$("<div></div>");t.append(e),i=null===this.pageConfig.content?"":this.pageConfig.content;var i=$("<p>"+i+"</p>");e.append(i),!0===this.pageConfig.showWaveform&&(i=$("<p></p>"),e.append(i),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",i,this.stimulus,this.pageConfig.showWaveform,!1,this.filePlayer.genericAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load()),Object.getPrototypeOf(LikertSingleStimulusPage.prototype).render.call(this,t)},LikertSingleStimulusPage.prototype.load=function(){Object.getPrototypeOf(LikertSingleStimulusPage.prototype).load.call(this),this.startTimeOnPage=new Date},LikertSingleStimulusPage.prototype.save=function(){Object.getPrototypeOf(LikertSingleStimulusPage.prototype).save.call(this),this.time+=new Date-this.startTimeOnPage},LikertSingleStimulusPage.prototype.store=function(){var t=this.session.getTrial(this.pageConfig.type,this.pageConfig.id);null===t&&((t=new Trial).type=this.pageConfig.type,t.id=this.pageConfig.id,this.session.trials[this.session.trials.length]=t);var e=new LikertResponse;e.stimulus=this.stimulus.id,e.stimulusRating={},e.time=this.time,t.responses[t.responses.length]=e,Object.getPrototypeOf(LikertSingleStimulusPage.prototype).store.call(this,e.stimulusRating,this.session.trials)},LikertSingleStimulusPageManager.prototype.createPages=function(t,e,i,o,n,s,a,r,l,h,p){var u,d=[];for(u in i.stimuli)d[d.length]=new Stimulus(u,i.stimuli[u]);shuffle(d);var g=d.length;0<i.maxStimuli&&(g=Math.min(g,i.maxStimuli));for(var c=0;c<g;++c){var f=new LikertSingleStimulusPage(t,e,i,o,n,s,a,r,l,h,d[c]);t.insertPage(f,p),++p}return p},MushraPage.prototype=Object.create(AudioPage.prototype),MushraPage.prototype.constructor=MushraPage,MushraPage.prototype.init=function(){var s,a,r;for(Object.getPrototypeOf(MushraPage.prototype).init.call(this),!1!==this.pageConfig.strict&&(this.mushraValidator.checkNumConditions(this.conditions),this.mushraValidator.checkStimulusDuration(this.reference)),this.mushraValidator.checkNumChannels(this.audioContext,this.reference),r=0;r<this.conditions.length;++r)this.mushraValidator.checkSamplerate(this.audioContext.sampleRate,this.conditions[r]);this.mushraValidator.checkConditionConsistency(this.reference,this.conditions),this.mushraAudioControl=new MushraAudioControl(this.audioContext,this.bufferSize,this.reference,this.conditions,this.errorHandler,this.pageConfig.createAnchor35,this.pageConfig.createAnchor70,this.pageConfig.randomize),this.mushraAudioControl.addEventListener(function(t){if("stopTriggered"==t.name){for($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),r=0;r<t.conditionLength;r++)if(a="#buttonConditions"+r,s=$(".scales").get(r),"true"==$(a).attr("active")){$.mobile.activePage.find(a).removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$(s).slider("disable"),$(s).attr("active","false"),$(a).attr("active","false");break}$.mobile.activePage.find("#buttonStop").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find("#buttonStop").focus(),$("#buttonStop").attr("active","true")}else if("playReferenceTriggered"==t.name){var e;for("true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false")),e=0;e<t.conditionLength;e++)if(a="#buttonConditions"+e,s=$(".scales").get(e),"true"==$(a).attr("active")){$.mobile.activePage.find(a).removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$(a).attr("active","false"),$(s).slider("disable"),$(s).attr("active","false");break}$.mobile.activePage.find("#buttonReference").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find("#buttonReference").focus(),$("#buttonReference").attr("active","true")}else if("playConditionTriggered"==t.name){var i,o=t.index,n=$(".scales").get(o),o="#buttonConditions"+o;for("true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),i=0;i<t.length;i++)if(a="#buttonConditions"+i,s=$(".scales").get(i),"true"==$(a).attr("active")){$.mobile.activePage.find(a).removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$(s).slider("disable"),$(a).attr("active","false"),$(s).attr("active","false");break}$(n).slider("enable"),$(n).attr("active","true"),$.mobile.activePage.find(o).removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find(o).focus(),$(o).attr("active","true")}}.bind(this))},MushraPage.prototype.render=function(t){var e=$("<div></div>");t.append(e),n=null===this.pageConfig.content?"":this.pageConfig.content;var i=$("<p>"+n+"</p>");e.append(i);var o=$("<table id='mainUp'></table>"),n=$("<table id='mainDown' align = 'center'></table>");e.append(o),e.append(n);i=$("<tr id='trWs'></tr>");o.append(i);e=$("     <td class='stopButton'>       <button data-role='button' data-inline='true' id='buttonStop' onclick='"+this.pageManager.getPageVariableName(this)+".mushraAudioControl.stop();'>"+this.pageManager.getLocalizer().getFragment(this.language,"stopButton")+"</button>     </td>   ");i.append(e);o=$("<td></td>");i.append(o);e=$("<tr></tr>");n.append(e);i=$("<td id='td_Mushra' colspan='2'></td>");e.append(i);n=$("<table id='mushra_items'></table>");i.append(n);var s=$("<tr></tr>");n.append(s);e=$("<td>"+this.pageManager.getLocalizer().getFragment(this.language,"reference")+"</td>");s.append(e);i=$("<td id='conditionNameScale'></td>");s.append(i);for(var a=this.mushraAudioControl.getConditions(),r=0;r<a.length;++r){var l="";!0===this.pageConfig.showConditionNames&&(l="en"==this.language?"<br/>"+a[r].id:"reference"==a[r].id?"<br/>"+this.pageManager.getLocalizer().getFragment(this.language,"reference"):"anchor35"==a[r].id?"<br/>"+this.pageManager.getLocalizer().getFragment(this.language,"35"):"anchor70"==a[r].id?"<br/>"+this.pageManager.getLocalizer().getFragment(this.language,"70"):"<br/>"+a[r].id),td=$("<td>"+this.pageManager.getLocalizer().getFragment(this.language,"cond")+(r+1)+l+"</td>"),s.append(td)}var h=$("<tr></tr>");n.append(h);e=$("<td></td>");h.append(e);i=$("<button data-theme='a' id='buttonReference' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackReference()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button>");e.append(i);i=$("<td></td>");for(h.append(i),r=0;r<a.length;++r){td=$("<td></td>");var p=$("<button data-role='button' class='center audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackCondition("+r+");'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button>");p.attr("id","buttonConditions"+r),td.append(p),h.append(td)}var u=$("<tr id='tr_ConditionRatings'></tr>");n.append(u);n=$("<td id='refCanvas'></td>");u.append(n);n=$("<td id='spaceForScale'></td>");for(u.append(n),r=0;r<a.length;++r)td=$("<td class='spaceForSlider'>       <span><input type='range' name='"+a[r].getId()+"' class='scales' value='100' min='0' max='100' data-vertical='true' data-highlight='true' style='display : inline-block; float : none;'/></span>     </td>"),$(".ui-slider-handle").unbind("keydown"),u.append(td);this.macic=new MushraAudioControlInputController(this.mushraAudioControl,this.pageConfig.enableLooping),this.macic.bind(),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",o,this.reference,this.pageConfig.showWaveform,this.pageConfig.enableLooping,this.mushraAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load(),Object.getPrototypeOf(MushraPage.prototype).render.call(this,t)},MushraPage.prototype.pause=function(){this.mushraAudioControl.pause()},MushraPage.prototype.setLoopStart=function(){var t=document.getElementById("slider"),e=this.mushraAudioControl.audioCurrentPosition,t=parseFloat(t.noUiSlider.get()[1]);this.mushraAudioControl.setLoop(e,t)},MushraPage.prototype.setLoopEnd=function(){var t=document.getElementById("slider"),e=parseFloat(t.noUiSlider.get()[0]),t=this.mushraAudioControl.audioCurrentPosition;this.mushraAudioControl.setLoop(e,t)},MushraPage.prototype.btnCallbackReference=function(){this.currentItem="ref";var t=$("#buttonReference").text();t==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):t==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playReference(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")))},MushraPage.prototype.btnCallbackCondition=function(t){this.currentItem=t;var e=$("#buttonConditions"+t).text();e==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions"+t).text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):e==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(t),$("#buttonConditions"+t).text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")))},MushraPage.prototype.renderCanvas=function(t){$("#mushra_canvas").remove(),parent=$("#"+t);t=document.createElement("canvas");t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.zIndex=0,t.setAttribute("id","mushra_canvas"),parent.get(0).appendChild(t),$("#mushra_canvas").offset({top:$("#refCanvas").offset().top,left:$("#refCanvas").offset().left}),t.height=parent.get(0).offsetHeight-(parent.get(0).offsetHeight-$("#tr_ConditionRatings").height()),t.width=parent.get(0).offsetWidth,$(".scales").siblings().css("zIndex","1"),$(".scales").slider("disable");var i=t.getContext("2d"),t=$(".scales").prev().offset().top-$(".scales").parent().offset().top,o=$(".scales").parent().get(0).offsetTop+parseInt($(".scales").css("borderTopWidth"),10)+t,n=$(".scales").prev().height(),e=$("#spaceForScale").offset().left-$("#spaceForScale").parent().offset().left+1.5*i.measureText("100 ").width,s=-$("#mushra_items").offset().left-($("#mushra_canvas").offset().left-$("#mushra_items").offset().left),a=$(".scales").first().prev().children().eq(0).offset().left+s,t=$(".scales").last().offset().left-$("#mushra_items").offset().left+$(".scales").last().width()/2;i.beginPath(),i.moveTo(e,o),i.lineTo(t,o),i.stroke();for(var r=[.2,.4,.6,.8],l=0;l<r.length;++l){i.beginPath(),i.moveTo(e,n*r[l]+o),i.lineTo(a,n*r[l]+o),i.stroke();var h=null;$(".scales").each(function(t){var e=$(this).prev().first();0<t&&(i.beginPath(),i.moveTo(h,n*r[l]+o),i.lineTo(e.offset().left+s,n*r[l]+o),i.stroke()),h=e.offset().left+e.width()+s+1})}i.beginPath(),i.moveTo(e,n+o),i.lineTo(t,n+o),i.stroke(),i.font="1.25em Calibri",i.textBaseline="middle",i.textAlign="center";t=$("#refCanvas").width()+($("#spaceForScale").width()+i.measureText("1 ").width)/2;i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"excellent"),t,.1*n+o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"good"),t,.3*n+o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"fair"),t,.5*n+o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"poor"),t,.7*n+o),i.fillText(this.pageManager.getLocalizer().getFragment(this.language,"bad"),t,.9*n+o),i.font="1em Calibri",i.textAlign="right";t=e-.25*i.measureText("100 ").width;i.fillText("100",t,o),i.fillText("80",t,.2*n+o),i.fillText("60",t,.4*n+o),i.fillText("40",t,.6*n+o),i.fillText("20",t,.8*n+o),i.fillText("0",t,n+o)},MushraPage.prototype.load=function(){if(Object.getPrototypeOf(MushraPage.prototype).load.call(this),this.startTimeOnPage=new Date,this.renderCanvas("mushra_items"),this.mushraAudioControl.initAudio(),0!==this.ratings.length)for(var t=$(".scales"),e=0;e<t.length;++e)$(".scales").eq(e).val(this.ratings[e].value).slider("refresh");null!==this.loop.start&&null!==this.loop.end&&(this.mushraAudioControl.setLoop(0,0,this.mushraAudioControl.getDuration(),this.mushraAudioControl.getDuration()/this.waveformVisualizer.stimulus.audioBuffer.sampleRate),this.mushraAudioControl.setPosition(0))},MushraPage.prototype.save=function(){Object.getPrototypeOf(MushraPage.prototype).save.call(this),this.macic.unbind(),this.time+=new Date-this.startTimeOnPage,this.mushraAudioControl.freeAudio(),this.mushraAudioControl.removeEventListener(this.waveformVisualizer.numberEventListener);var t,e=$(".scales");for(this.ratings=[],t=0;t<e.length;++t)this.ratings[t]={name:e[t].name,value:e[t].value};this.loop.start=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopStart),this.loop.end=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopEnd)},MushraPage.prototype.store=function(){var t,e=new Trial;for(e.type=this.pageConfig.type,e.id=this.pageConfig.id,t=0;t<this.ratings.length;++t){var i=this.ratings[t],o=new MUSHRARating;o.stimulus=i.name,o.score=i.value,o.time=this.time,e.responses[e.responses.length]=o}this.session.trials[this.session.trials.length]=e,Object.getPrototypeOf(MushraPage.prototype).store.call(this,e,this.session.trials)},Page.prototype.getName=function(){return this.pageConfig.name},Page.prototype.init=function(){for(var t=0;t<this.pageConfig.questionnaire.length;++t){var e=this.pageConfig.questionnaire[t];"likert"===e.type&&(this.likertObjects[e.name]=new LikertScale(e.response,e.name,this.pageConfig.mustPlayback))}},Page.prototype.renderQuestionnaire=function(t,e){void 0===e&&(e="");for(var i=$("<table align='center'></table>"),o=0;o<t.length;++o){var n=t[o],s=e+n.name,a=$("<td style='text-align: right; padding-right: 10px;'></td>");n.label&&a.append($("<strong>"+n.label+"</strong>"));var r=$("<td></td>");if(i.append($("<tr></tr>").append(a,r)),["text","email","password","file"].includes(n.type))r.append($("<input type='"+n.type+"' id='"+s+"' data-clear-btn='true'/>"));else if("number"===n.type)r.append($("<input id='"+s+"' value='"+n.default+"' data-clear-btn='true' pattern='[\\d.,]+' data-inline='true'/>"));else if("long_text"===n.type)a.attr("id","labeltd"),a.attr("style","vertical-align:top"),r.append($("<textarea name='"+s+"' id='"+s+"'></textarea>"));else if("date"===n.type)r.append($("<input type='date' id='"+s+"' />"));else if("likert"===n.type)this.likertObjects[s].render(r);else if("dropdown"===n.type){for(var l=$("<select id='"+s+"'/>"),h=0;h<n.response.length;++h)l.append($("<option value='"+n.response[h].value+"'"+(!0===n.response[h].selected?" selected=''":"")+">"+n.response[h].label+"</option>"));r.append(l)}else if("checkbox"===n.type)r.append($("<input type='checkbox' id='"+s+"' name='"+s+"_response' value='checked' style='margin-top: -16px; width: 100%' />"));else if("slider"===n.type)r.append($("<input type='range' id='"+s+"' min='"+n.min+"' max='"+n.max+"' value='"+n.default+"' data-clear-btn='true' data-inline='true'/>"));else if("toggle"===n.type){for(var p=$("<select data-role='slider' id='"+s+"'/>"),h=0;h<n.response.length;++h)p.append($("<option value='"+n.response[h].value+"'"+(!0===n.response[h].selected?" selected=''":"")+">"+n.response[h].label+"</option>"));r.append(p)}"likert"!==n.type&&this.pageConfig.mustPlayback&&r.children().prop("disabled",!0)}return i},Page.prototype.enableQuestionnaire=function(t,e){for(void 0===e&&(e=""),i=0;i<t.length;++i){var o=t[i],n=e+o.name;["text","email","password","file","number","long_text","date"].includes(o.type)?$("#"+n).textinput("enable"):"likert"===o.type?this.likertObjects[n].enable():"checkbox"===o.type?($("#"+n).checkboxradio("enable"),$("#"+n).parent().removeClass("ui-state-disabled")):["toggle","slider"].includes(o.type)&&$("#"+n).slider("enable")}},Page.prototype.render=function(t){var e=this.renderQuestionnaire(this.pageConfig.questionnaire);t.append(e)},Page.prototype.checkQuestionnaireCompletion=function(t,e){void 0===e&&(e="");for(var i=0,o=0;o<t.length;++o){var n=t[o],s=e+n.name;["text","email","password","file","number","long_text","date","dropdown","slider","toggle"].includes(n.type)?!$("#"+s).val()&&1!=n.optional||++i:["likert","checkbox"].includes(n.type)&&(!$("input[name='"+s+"_response']:checked").val()&&1!=n.optional||++i)}return i===t.length},Page.prototype.restoreQuestionnaire=function(t,e,i){void 0===i&&(i="");for(var o=0;o<t.length;++o){var n=t[o],s=e[n.name],a=i+n.name;void 0!==s&&(["text","number","long_text","date"].includes(n.type)?$("#"+a).val(s):"likert"===n.type?($("input[name='"+a+"_response'][value='"+s+"']").prop("checked",!0).checkboxradio("refresh"),this.likertObjects[a].group.change()):"toggle"===n.type?$("#"+a).val(s).slider("refresh"):"checkbox"===n.type&&$("#"+a).prop("checked",s).checkboxradio("refresh"))}},Page.prototype.load=function(o){$("#labeltd").css("padding-top",$("#feedback").css("margin-top")),0<this.pageConfig.questionnaire.length&&(this.pageTemplateRenderer.lockNextButton(),this.restoreQuestionnaire(this.pageConfig.questionnaire,this.questionnaireResponses),this.interval=setInterval(function(){var t=this.checkQuestionnaireCompletion(this.pageConfig.questionnaire);if(void 0!==o)for(var e=0;e<o.length;++e)var i=o[e],t=t&&this.checkQuestionnaireCompletion(i[0],i[1]);t?(this.pageTemplateRenderer.unlockNextButton(),$("#send_results").removeAttr("disabled")):(this.pageTemplateRenderer.lockNextButton(),$("#send_results").prop("disabled",!0))}.bind(this),50))},Page.prototype.readQuestionnaire=function(t,e,i){void 0===i&&(i="");for(var o=0;o<t.length;++o){var n=t[o],s=i+n.name;"likert"===n.type?e[n.name]=$("input[name='"+s+"_response']:checked").val():"checkbox"===n.type?e[n.name]=$("#"+s).prop("checked"):e[n.name]=$("#"+s).val()}},Page.prototype.save=function(){clearInterval(this.interval),this.readQuestionnaire(this.pageConfig.questionnaire,this.questionnaireResponses)},Page.prototype.store=function(t,e){if(void 0!==t&&Object.assign(t,this.questionnaireResponses),this.pageConfig.send&&void 0!==e&&(this.sendError=this.dataSender.send(this.session),!1===this.sendError&&"forget"===this.pageConfig.send))if(Array.isArray(e))e.length=0;else for(var i in e)delete e[i]},PairedComparisonPage.prototype=Object.create(AudioPage.prototype),PairedComparisonPage.prototype.constructor=PairedComparisonPage,PairedComparisonPage.prototype.init=function(){Object.getPrototypeOf(PairedComparisonPage.prototype).init.call(this),this.mushraAudioControl=new MushraAudioControl(this.audioContext,this.bufferSize,this.reference,[this.condition],this.errorHandler,!1,!1),this.mushraAudioControl.addEventListener(function(t){"stopTriggered"==t.name&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions1").attr("active","false")),$.mobile.activePage.find("#buttonStop").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find("#buttonStop").focus(),$("#buttonStop").attr("active","true"))}.bind(this))},PairedComparisonPage.prototype.render=function(t){var e=$("<div></div>");t.append(e),o=null===this.pageConfig.content?"":this.pageConfig.content;var i=$("<p>"+o+"</p>");e.append(i);var o=$("<table id='main' align='center'></table>");e.append(o);i=$("<tr id='trWs'></tr>");o.append(i);e=$("     <td class='stopButton'>       <button data-role='button' data-inline='true' id='buttonStop' class='center' onclick='"+this.pageManager.getPageVariableName(this)+".mushraAudioControl.stop();'>"+this.pageManager.getLocalizer().getFragment(this.language,"stopButton")+"</button>     </td>   ");i.append(e);e=$("<td></td>");i.append(e),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",e,this.reference,this.pageConfig.showWaveform,this.pageConfig.enableLooping,this.mushraAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load();i=$("<tr></tr>");o.append(i);e=$("<td id='td_AB' colspan='2'></td>");i.append(e);o=$("<table id='table_ab' class='center'></table>");e.append(o);i=$("<tr><td>"+this.pageManager.getLocalizer().getFragment(this.language,"reference")+"</td><td>A</td><td>B</td></tr>");o.append(i);e=$("<tr></tr>");o.append(e);i=$("<td><button data-theme='a' id='buttonReference' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackReference()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");e.append(i);i=$("<td><button data-theme='a' id='buttonConditions0' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackA()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");e.append(i);i=$("<td><button data-theme='a' id='buttonConditions1' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackB()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");e.append(i);i=$("<tr><td  colspan='3'><br/><br/>"+this.pageManager.getLocalizer().getFragment(this.language,"quest")+"</td></tr>");o.append(i);i=$("<tr></tr>");o.append(i);o=$("<td  colspan='3'></td>");i.append(o);i=$("<div id='radio-choice' data-role='controlgroup' data-type='horizontal'>    <input type='radio' name='radio-choice' id='radio-choice-a' value='a'>    <label for='radio-choice-a'>A</label>    <input type='radio' name='radio-choice' id='radio-choice-b' value='b'>    <label for='radio-choice-b'>B</label>  </div>");this.pageConfig.unforced&&i.append($("<input type='radio' name='radio-choice' id='radio-choice-n' value='n'><label for='radio-choice-n'>"+this.pageConfig.unforced+"</label>")),i.find("input[type='radio']").bind("change",function(){this.pageTemplateRenderer.unlockNextButton()}.bind(this)),o.append(i),Object.getPrototypeOf(PairedComparisonPage.prototype).render.call(this,t),this.macic=new MushraAudioControlInputController(this.mushraAudioControl,this.pageConfig.enableLooping),this.macic.bind()},PairedComparisonPage.prototype.setLoopStart=function(){var t=document.getElementById("slider"),e=this.mushraAudioControl.audioCurrentPosition,t=parseFloat(t.noUiSlider.get()[1]);this.mushraAudioControl.setLoop(e,t)},PairedComparisonPage.prototype.setLoopEnd=function(){var t=document.getElementById("slider"),e=parseFloat(t.noUiSlider.get()[0]),t=this.mushraAudioControl.audioCurrentPosition;this.mushraAudioControl.setLoop(e,t)},PairedComparisonPage.prototype.pause=function(){this.mushraAudioControl.pause()},PairedComparisonPage.prototype.cleanButtons=function(){"true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions1").attr("active","false"))},PairedComparisonPage.prototype.btnCallbackReference=function(){this.currentItem="ref";var t=$("#buttonReference").text();t==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):t==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playReference(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonReference").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonReference").focus(),$("#buttonReference").attr("active","true"))},PairedComparisonPage.prototype.btnCallbackA=function(){this.currentItem="A";var t=$("#buttonConditions0").text();t==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):t==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(0),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonConditions0").focus(),$("#buttonConditions0").attr("active","true"))},PairedComparisonPage.prototype.btnCallbackB=function(){this.currentItem="B";var t=$("#buttonConditions1").text();t==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):t==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(1),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonConditions1").focus(),$("#buttonConditions1").attr("active","true"))},PairedComparisonPage.prototype.load=function(){Object.getPrototypeOf(PairedComparisonPage.prototype).load.call(this),this.startTimeOnPage=new Date,null===this.choice&&this.pageTemplateRenderer.lockNextButton(),this.mushraAudioControl.initAudio(),"a"===this.choice?($("#radio-choice-a").prop("checked",!0).checkboxradio("refresh"),$("#radio-choice-b").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-n").prop("checked",!1).checkboxradio("refresh")):"b"===this.choice?($("#radio-choice-b").prop("checked",!0).checkboxradio("refresh"),$("#radio-choice-a").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-n").prop("checked",!1).checkboxradio("refresh")):"n"===this.choice&&($("#radio-choice-b").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-a").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-n").prop("checked",!0).checkboxradio("refresh")),null!==this.loop.start&&null!==this.loop.end&&(this.mushraAudioControl.setLoop(0,0,this.mushraAudioControl.getDuration(),this.mushraAudioControl.getDuration()/this.waveformVisualizer.stimulus.audioBuffer.sampleRate),this.mushraAudioControl.setPosition(0))},PairedComparisonPage.prototype.save=function(){Object.getPrototypeOf(PairedComparisonPage.prototype).save.call(this),this.macic.unbind(),this.time+=new Date-this.startTimeOnPage,this.mushraAudioControl.removeEventListener(this.waveformVisualizer.numberEventListener),this.mushraAudioControl.freeAudio();var t=$("#radio-choice :radio:checked");this.choice=0<t.length?t[0].value:null,this.loop.start=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopStart),this.loop.end=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopEnd)},PairedComparisonPage.prototype.store=function(){var t=this.session.getTrial(this.pageConfig.type,this.pageConfig.id);null===t&&((t=new Trial).type=this.pageConfig.type,t.id=this.pageConfig.id,this.session.trials[this.session.trials.length]=t);var e=new PairedComparisonChoice;e.reference=this.reference.getId(),e.nonReference=this.condition.getId();var i=0===this.mushraAudioControl.getReferenceIndexOfConditions();"a"===this.choice&&i||"b"===this.choice&&!i?e.answer="correct":e.answer="incorrect",null===this.choice?e.answer="unknown":"n"===this.choice&&(e.answer="undecided"),e.time=this.time,t.responses[t.responses.length]=e,Object.getPrototypeOf(PairedComparisonPage.prototype).store.call(this,e,this.session.trials)},PairedComparisonPageManager.prototype.createPages=function(t,e,i,o,n,s,a,r,l,h,p){for(var u in stimuli=[],i.stimuli)stimuli[stimuli.length]=new Stimulus(u,i.stimuli[u]);var d=new Stimulus("reference",i.reference);shuffle(stimuli);for(var g=0;g<stimuli.length;++g){var c=new PairedComparisonPage(t,e,i,o,n,s,a,r,l,h,d,stimuli[g]);t.insertPage(c,p),++p}return p},SpatialPage.prototype=Object.create(AudioPage.prototype),SpatialPage.prototype.constructor=SpatialPage,SpatialPage.prototype.initScenes=function(){for(var t,e=0;e<this.pageConfig.views.length;++e)this.renderDivs[e]=document.createElement("div"),this.renderDivs[e].setAttribute("id","renderArea"+e),this.renderDivs[e].setAttribute("style","border = solid"),"front"==this.pageConfig.views[e].view?(this.renderDivs[e].setAttribute("width",this.pageConfig.roomMeasurements[0]),this.renderDivs[e].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[e]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[e]),this.cameras[e].setPosition(0,this.pageConfig.roomMeasurements[1]/2,800,0,0,0)):"back"==this.pageConfig.views[e].view?(this.renderDivs[e].setAttribute("width",this.pageConfig.roomMeasurements[0]),this.renderDivs[e].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[e]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[e]),this.cameras[e].setPosition(0,this.pageConfig.roomMeasurements[1]/2,-800,0,180,0)):"top"==this.pageConfig.views[e].view?(this.renderDivs[e].setAttribute("width",this.pageConfig.roomMeasurements[0]),this.renderDivs[e].setAttribute("height",this.pageConfig.roomMeasurements[2]),this.cameras[e]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[e]),this.cameras[e].setPosition(0,500,0,90,180,180)):"right"==this.pageConfig.views[e].view?(this.renderDivs[e].setAttribute("width",this.pageConfig.roomMeasurements[2]),this.renderDivs[e].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[e]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[e]),this.cameras[e].setPosition(500,this.pageConfig.roomMeasurements[1]/2,0,0,90,0)):"left"==this.pageConfig.views[e].view?(this.renderDivs[e].setAttribute("width",this.pageConfig.roomMeasurements[2]),this.renderDivs[e].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[e]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[e]),this.cameras[e].setPosition(-500,this.pageConfig.roomMeasurements[1]/2,0,0,-90,0)):"3d"==this.pageConfig.views[e].view&&(this.renderDivs[e].setAttribute("width",this.pageConfig.roomMeasurements[2]),this.renderDivs[e].setAttribute("height",this.pageConfig.roomMeasurements[1]),t=this.pageConfig.views[e].position,this.pageConfig.views[e].rotation,this.cameras[e]=new Camera(CameraType.PERSPECTIVE,this.renderDivs[e]),this.cameras[e].setPosition(t[0],t[1],t[2],0,0,0)),this.scenes[e]=new Scene(this.renderDivs[e],this.cameras[e],this.pageConfig,this.pageConfig.views[e]),this.renderDivs[e].onmousedown=function(t){this.page.mouseDown=!0;var e=$(t.target).parent().offset(),i=parseFloat(this.div.getAttribute("width")),o=parseFloat(this.div.getAttribute("height")),i=t.pageX-e.left-i/2,e=t.pageY-e.top-o/2;if(null!==this.page.activeResponse)for(var n=this.page.responses[this.page.activeResponse].objects,o=n[0].getCenterPosition(),s=this.scene.transformRelativeCoordinates(i,e,o[0],o[1],o[2]),a=0;a<n.length;++a)n[a].eventOnMouseDown&&n[a].eventOnMouseDown(t,s[0],s[1],s[2])}.bind({page:this,div:this.renderDivs[e],scene:this.scenes[e]}),this.renderDivs[e].onmouseup=function(t){this.page.mouseDown=!1}.bind({page:this}),this.renderDivs[e].onmousemove=function(t){var e=(new Date).getTime();if(e-this.page.time>=this.page.framerate){this.page.time=e,console.log("update");var i=$(t.target).parent().offset(),o=parseFloat(this.div.getAttribute("width")),e=parseFloat(this.div.getAttribute("height")),o=t.pageX-i.left-o/2,i=t.pageY-i.top-e/2;if(1==this.page.mouseDown&&null!==this.page.activeResponse)for(var n=this.page.responses[this.page.activeResponse].objects,e=n[0].getCenterPosition(),s=this.scene.transformRelativeCoordinates(o,i,e[0],e[1],e[2]),a=0;a<n.length;++a)n[a].eventOnMouseMove&&"PerspectiveCamera"!=this.scene.camera.type&&n[a].eventOnMouseMove(t,s[0],s[1],s[2])}}.bind({page:this,div:this.renderDivs[e],scene:this.scenes[e]});for(e=0;e<this.pageConfig.views.length;++e)this.scenes[e].load();for(e=0;e<this.pageConfig.objects.length;++e){var i=this.pageConfig.objects[e];if("listener"==i.type)for(var o=0;o<this.pageConfig.views.length;++o)this.scenes[o].addListener(i);else if("custom"==i.type)for(o=0;o<this.pageConfig.views.length;++o)this.scenes[o].addCustomObject(i)}for(e=0;e<this.pageConfig.responses.length;++e){var n=this.pageConfig.responses[e];if("localization"==n.type){this.responses[n.name]={objects:[],config:n};for(o=0;o<this.pageConfig.views.length;++o){var s=new LocalizationObject(n);s.init(this.scenes[o].scene),this.responses[n.name].objects[this.responses[n.name].objects.length]=s}}if("lev"==n.type){this.responses[n.name]={objects:[],config:n};for(o=0;o<this.pageConfig.views.length;++o){var a=new LEVObject(n);a.init(this.scenes[o].scene),this.responses[n.name].objects[this.responses[n.name].objects.length]=a}}if("asw"==n.type){this.responses[n.name]={objects:[],config:n};for(o=0;o<this.pageConfig.views.length;++o){n.height=null,n.depth=null;var r=new ASWObject(n);r.init(this.scenes[o].scene),this.responses[n.name].objects[this.responses[n.name].objects.length]=r}}if("hwd"==n.type){this.responses[n.name]={objects:[],config:n};for(o=0;o<this.pageConfig.views.length;++o){var l=new ASWObject(n);l.init(this.scenes[o].scene),this.responses[n.name].objects[this.responses[n.name].objects.length]=l}}}},SpatialPage.prototype.init=function(){Object.getPrototypeOf(SpatialPage.prototype).init.call(this),this.initScenes(),this.filePlayer=new FilePlayer(this.audioContext,this.bufferSize,this.stimuli,this.errorHandler,this.language,this.pageManager.getLocalizer())},SpatialPage.prototype.render=function(t){var e,i=document.createElement("div");void 0!==this.pageConfig.content&&(e=this.pageConfig.content,(o=document.createElement("div")).innerHTML=e,i.appendChild(o)),t.append(i);var o=document.createElement("table");o.setAttribute("border","0"),o.setAttribute("align","center"),o.setAttribute("style","margin-top: 0em;");for(var n=document.createElement("tr"),s=0;s<this.stimuli.length;++s){var a=$("<td></td>"),r=$("<div id='spatial_stimuli_"+s+"' class='ui-body ui-body-a ui-corner-all'></div>");a.append(r),this.filePlayer.renderElement(r,s),n.appendChild(a.get(0))}o.appendChild(n),i.appendChild(o);for(s=0;s<this.pageConfig.responses.length;++s){for(var l=this.pageConfig.responses[s],h=null,p=0;p<this.stimuli.length;++p)if(this.stimuli[p].getId()==l.stimulus){this.stimuli[p],h=p;break}var u="#"+((1<<24)+l.color).toString(16).substr(1);button=$("<button id='"+l.name+"' data-inline='true' style='background-color:#"+((1<<24)+l.color).toString(16).substr(1)+"; background-image:radial-gradient(#ffffff 0%, "+u+" 100%)'>"+l.label+"</button>"),button.on("click",function(){this.page.setBoxShadow(this.page.activeResponse,this.name,"#555555"),this.page.activeResponse=this.name}.bind({page:this,label:l.label,name:l.name,button:button})),$("#spatial_stimuli_"+h).append(button)}o=document.createElement("table");o.setAttribute("border","0"),o.setAttribute("align","center"),o.setAttribute("style","margin-top: 0em;");for(var d=document.createElement("tr"),s=0;s<this.pageConfig.views.length;++s)(a=document.createElement("td")).appendChild(this.renderDivs[s]),d.appendChild(a);o.appendChild(d),i.appendChild(o),this.renderScene(),t.append(i),Object.getPrototypeOf(SpatialPage.prototype).render.call(this,t)},SpatialPage.prototype.setBoxShadow=function(t,e,i){null!=t&&(document.getElementById(t).style.boxShadow="0 0 0 white , 0 0 0 white"),document.getElementById(e).style.boxShadow="0 0 30px "+i+" , 0 0 30px "+i},SpatialPage.prototype.renderScene=function(){for(var t=0;t<this.pageConfig.views.length;++t)this.scenes[t].render()},SpatialPage.prototype.store=function(){var t=this.session.getTrial("localization",this.pageConfig.id),e=this.session.getTrial("asw",this.pageConfig.id),i=this.session.getTrial("lev",this.pageConfig.id),o=this.session.getTrial("hwd",this.pageConfig.id);for(key in this.responses)this.responses[key].objects[0]instanceof ASWObject&&0==key.height&&this.responses[key].objects[0].storeValues(e,this.session,this.pageConfig.id),this.responses[key].objects[0]instanceof LocalizationObject&&this.responses[key].objects[0].storeValues(t,this.session,this.pageConfig.id),this.responses[key].objects[0]instanceof LEVObject&&this.responses[key].objects[0].storeValues(i,this.session,this.pageConfig.id),this.responses[key].objects[0]instanceof ASWObject&&this.responses[key].objects[0].storeValues(o,this.session,this.pageConfig.id);Object.getPrototypeOf(SpatialPage.prototype).store.call(this,this.session.trials[this.session.trials.length-1],this.session.trials)},SpatialPage.prototype.load=function(){Object.getPrototypeOf(SpatialPage.prototype).load.call(this),this.startTimeOnPage=new Date,this.frameUpdateInterval=setInterval(function(){this.renderScene()}.bind(this),this.framerate),this.filePlayer.init()},SpatialPage.prototype.save=function(){Object.getPrototypeOf(SpatialPage.prototype).save.call(this),clearInterval(this.frameUpdateInterval),this.time+=new Date-this.startTimeOnPage,this.filePlayer.free()},VolumePage.prototype=Object.create(FilePlayerPage.prototype),VolumePage.prototype.constructor=VolumePage,VolumePage.prototype.init=function(){Object.getPrototypeOf(VolumePage.prototype).init.call(this,[this.stimulus],!1)},VolumePage.prototype.save=function(){Object.getPrototypeOf(VolumePage.prototype).save.call(this),this.volume=this.audioContext.volume},VolumePage.prototype.store=function(){Object.getPrototypeOf(VolumePage.prototype).store.call(this,this.session.participant,this.session.participant)},VolumePage.prototype.gainVolume=function(t){this.audioContext.volume=parseInt(t,10)/100},VolumePage.prototype.render=function(t){var e=$(" <p> "+this.pageConfig.content+" </p>"),i=$("<table width='600' style='margin: 0 auto;'></table>");i.append($("<tr></tr>").append($("<td></td>").append($('<input type="range" name="slider"  min="0" max="100" value="'+100*this.volume+'"  data-highlight="true" onchange = "'+this.pageManager.getPageVariableName(this)+'.gainVolume(this.value)">')))),t.append(e),t.append(i),Object.getPrototypeOf(VolumePage.prototype).render.call(this,t)},CameraType={PERSPECTIVE:0,ORTHOGRAPHIC:1},Camera.prototype.setPosition=function(t,e,i,o,n,s){this.camera.position.x=t,this.camera.position.y=e,this.camera.position.z=i,this.camera.rotation.x=2*o*Math.PI/360,this.camera.rotation.y=2*n*Math.PI/360,this.camera.rotation.z=2*s*Math.PI/360,0==this.type&&(this.camera.up.set(0,1,0),this.camera.lookAt(new THREE.Vector3(0,0,0))),this.camera.updateMatrix()},Camera.prototype.getCameraType=function(){return this.type},Camera.prototype.setCameraPolar=function(t,e,i){var o;i<Math.PI-.01&&.01<i&&(o=t*Math.sin(i)*Math.cos(e),e=t*Math.sin(i)*Math.sin(e),t=t*Math.cos(i),(i=new THREE.Vector3(o,t,e)).x=0,i.y=100,i.z=0,this.setCamera(o,t,e),this.camera.lookAt(i))},Camera.prototype.getCamera=function(){return this.camera},Camera.prototype.getCameraR=function(){var t=this.getCameraX(),e=this.getCameraY(),i=this.getCameraZ();return Math.sqrt(Math.pow(t,2)+Math.pow(i,2)+Math.pow(e,2))},Camera.prototype.getCameraPhi=function(){var t=this.getCameraX(),e=(this.getCameraY(),this.getCameraZ());return 0<t?Math.atan(e/t):0==t?e<0?-Math.PI/2:Math.PI/2:e<0?Math.atan(e/t)-Math.PI:Math.atan(e/t)+Math.PI},Camera.prototype.getCameraTheta=function(){this.getCameraX();var t=this.getCameraY();this.getCameraZ();return Math.acos(t/this.getCameraR())},Camera.prototype.getCameraX=function(){return this.camera.position.x},Camera.prototype.getCameraY=function(){return this.camera.position.y},Camera.prototype.getCameraZ=function(){return this.camera.position.z},Camera.prototype.getCameraRotX=function(){return this.camera.rotation.x},Camera.prototype.getCameraRotY=function(){return this.camera.rotation.y},Camera.prototype.getCameraRotZ=function(){return this.camera.rotation.z},ASWObject.prototype.init=function(t){this.scene=t,this.updateGeometry(),t.add(this.line1),0!=this.height&&t.add(this.line2);for(var e=0;e<this.points.length;++e)t.add(this.points[e])},ASWObject.prototype.update=function(){this.updateGeometry(),this.updateControlPolygon()},ASWObject.prototype.updateGeometry=function(){this.extrudeBend=new THREE.CubicBezierCurve3(new THREE.Vector3(this.controlPoints[3][0],this.controlPoints[3][1],this.controlPoints[3][2]),new THREE.Vector3(this.controlPoints[2][0],this.controlPoints[2][1],this.controlPoints[2][2]),new THREE.Vector3(this.controlPoints[1][0],this.controlPoints[1][1],this.controlPoints[1][2]),new THREE.Vector3(this.controlPoints[0][0],this.controlPoints[0][1],this.controlPoints[0][2]));var t=new THREE.Tube(1,64,20,this.extrudeBend,this.height/2,this.depth/2),e=new THREE.MeshPhongMaterial({color:this.objConfig.color,ambient:this.objConfig.color,opacity:.5,transparent:!0,side:THREE.DoubleSide});this.updateGroup(t,e)},ASWObject.prototype.updateGroup=function(t,e){if(null!=this.tmp){null!=this.scene&&this.scene.remove(this.group.children[0]);for(var i=0;i<this.tmp.length;i++)this.group.remove(this.tmp[i])}this.tmp[0]=new THREE.Mesh(t,e),this.group.add(this.tmp[0]),null!=this.scene&&(e=this.group.children[0],this.scene.add(this.group.children[0]),this.group.children[0]=e)},ASWObject.prototype.updateControlPolygon=function(){var t;this.points[0].position.set(this.controlPoints[0][0],this.controlPoints[0][1],this.controlPoints[0][2]),this.points[1].position.set(this.controlPoints[1][0],this.controlPoints[1][1],this.controlPoints[1][2]),this.points[2].position.set(this.controlPoints[2][0],this.controlPoints[2][1],this.controlPoints[2][2]),this.points[3].position.set(this.controlPoints[3][0],this.controlPoints[3][1],this.controlPoints[3][2]),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[0][0],this.controlPoints[0][1],this.controlPoints[0][2])),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[1][0],this.controlPoints[1][1],this.controlPoints[1][2])),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[2][0],this.controlPoints[2][1],this.controlPoints[2][2])),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[3][0],this.controlPoints[3][1],this.controlPoints[3][2])),this.line1=new THREE.Line(this.geometryLine1,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip),this.line1.geometry.verticesNeedUpdate=!0,0!=this.height&&0!=this.depth&&(this.midpointOnCurve[0]=.125*this.controlPoints[0][0]+.375*this.controlPoints[1][0]+.375*this.controlPoints[2][0]+.125*this.controlPoints[3][0],this.midpointOnCurve[1]=.125*this.controlPoints[0][1]+.375*this.controlPoints[1][1]+.375*this.controlPoints[2][1]+.125*this.controlPoints[3][1],this.midpointOnCurve[2]=.125*this.controlPoints[0][2]+.375*this.controlPoints[1][2]+.375*this.controlPoints[2][2]+.125*this.controlPoints[3][2],this.derivative[0]=3*(this.controlPoints[0][0]+this.controlPoints[1][0]-this.controlPoints[2][0]-this.controlPoints[3][0]),this.derivative[1]=3*(this.controlPoints[0][1]+this.controlPoints[1][1]-this.controlPoints[2][1]-this.controlPoints[3][1]),this.derivative[2]=3*(this.controlPoints[0][2]+this.controlPoints[1][2]-this.controlPoints[2][2]-this.controlPoints[3][2]),t=Math.sqrt(Math.pow(this.derivative[0],2)+Math.pow(this.derivative[2],2)),this.derivative[0]=this.derivative[0]/t,this.derivative[2]=this.derivative[2]/t,this.controlPoints[5][0]=this.midpointOnCurve[0]+this.derivative[2]*this.depth/2,this.controlPoints[5][1]=this.midpointOnCurve[1],this.controlPoints[5][2]=this.midpointOnCurve[2]-this.derivative[0]*this.depth/2,this.controlPoints[4][0]=this.midpointOnCurve[0],this.controlPoints[4][1]=this.midpointOnCurve[1]+this.height/2,this.controlPoints[4][2]=this.midpointOnCurve[2],this.points[4].position.set(this.controlPoints[4][0],this.controlPoints[4][1],this.controlPoints[4][2]),this.points[5].position.set(this.controlPoints[5][0],this.controlPoints[5][1],this.controlPoints[5][2]),this.geometryLine2.vertices.pop(),this.geometryLine2.vertices.pop(),this.geometryLine2.vertices.pop(),this.geometryLine2.vertices.push(new THREE.Vector3(this.controlPoints[4][0],this.controlPoints[4][1],this.controlPoints[4][2])),this.geometryLine2.vertices.push(new THREE.Vector3(this.midpointOnCurve[0],this.midpointOnCurve[1],this.midpointOnCurve[2])),this.geometryLine2.vertices.push(new THREE.Vector3(this.controlPoints[5][0],this.controlPoints[5][1],this.controlPoints[5][2])),this.line2=new THREE.Line(this.geometryLine2,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip),this.line2.geometry.verticesNeedUpdate=!0)},ASWObject.prototype.eventOnMouseUp=function(t,e,i,o){this.activeObj=null},ASWObject.prototype.eventOnMouseDown=function(t,e,i,o){if(null==e){this.activeObj=null;for(var n=0;n<this.controlPoints.length;++n)this.distance(new THREE.Vector3(this.controlPoints[n][0],i,o),new THREE.Vector3(this.controlPoints[n][0],this.controlPoints[n][1],this.controlPoints[n][2]))<10&&(this.activeObj=n)}else if(null==i){this.activeObj=null;for(n=0;n<this.controlPoints.length;++n)this.distance(new THREE.Vector3(e,this.controlPoints[n][1],o),new THREE.Vector3(this.controlPoints[n][0],this.controlPoints[n][1],this.controlPoints[n][2]))<10&&(this.activeObj=n)}if(null==o){this.activeObj=null;for(n=0;n<this.controlPoints.length;++n)this.distance(new THREE.Vector3(e,i,this.controlPoints[n][2]),new THREE.Vector3(this.controlPoints[n][0],this.controlPoints[n][1],this.controlPoints[n][2]))<10&&(this.activeObj=n)}},ASWObject.prototype.distance=function(t,e){var i=t.x-e.x,o=t.y-e.y,e=t.z-e.z;return Math.sqrt(i*i+o*o+e*e)},ASWObject.prototype.eventOnMouseMove=function(t,e,i,o){null!=this.activeObj&&(4==this.activeObj&&null!=i?this.height=2*(i-this.controlPoints[1][1]):5==this.activeObj&&null!=e&&null!=o?this.depth=Math.sqrt(Math.pow(e-this.midpointOnCurve[0],2)+Math.pow(o-this.midpointOnCurve[2],2)):(null!=e&&(this.controlPoints[this.activeObj][0]=e),null!=i&&0!=this.height&&(this.controlPoints[this.activeObj][1]=i),null!=o&&(this.controlPoints[this.activeObj][2]=o))),this.updateControlPolygon(),this.updateGeometry()},ASWObject.prototype.render=function(){},ASWObject.prototype.getCenterPosition=function(){return[this.group.position.x,this.group.position.y,this.group.position.z]},ASWObject.prototype.storeValues=function(t,e,i){var o;null===t&&((t=new Trial).type=this.objConfig.type,t.id=i,e.trials[e.trials.length]=t),0==this.height?((o=new SpatialASWRating).stimulus=this.objConfig.stimulus,o.name=this.objConfig.name,o.position_outerRight=this.controlPoints[3],o.position_innerRight=this.controlPoints[2],o.position_innerLeft=this.controlPoints[1],o.position_outerLeft=this.controlPoints[0]):((o=new SpatialHWDRating).stimulus=this.objConfig.stimulus,o.name=this.objConfig.name,o.position_outerRight=this.controlPoints[3],o.position_innerRight=this.controlPoints[2],o.position_innerLeft=this.controlPoints[1],o.position_outerLeft=this.controlPoints[0],o.height=this.height,o.depth=this.depth),t.responses[t.responses.length]=o},LEVObject.prototype.init=function(t){t.add(this.dragNdrop0),t.add(this.dragNdrop1),t.add(this.dragNdrop2),t.add(this.dragNdrop3),t.add(this.xAxis),t.add(this.yAxis),t.add(this.zAxis),t.add(this.mesh)},LEVObject.prototype.eventOnMouseUp=function(t,e,i,o){this.activeObj=null},LEVObject.prototype.eventOnMouseDown=function(t,e,i,o){null==e?this.distance(new THREE.Vector3(this.dragNdrop0.position.x,i,o),new THREE.Vector3(this.dragNdrop0.position.x,this.dragNdrop0.position.y,this.dragNdrop0.position.z))<10?this.activeObj=0:this.distance(new THREE.Vector3(this.dragNdrop1.position.x,i,o),new THREE.Vector3(this.dragNdrop1.position.x,this.dragNdrop1.position.y,this.dragNdrop1.position.z))<10?this.activeObj=1:this.distance(new THREE.Vector3(this.dragNdrop2.position.x,i,o),new THREE.Vector3(this.dragNdrop2.position.x,this.dragNdrop2.position.y,this.dragNdrop2.position.z))<10?this.activeObj=2:this.distance(new THREE.Vector3(this.dragNdrop3.position.x,i,o),new THREE.Vector3(this.dragNdrop3.position.x,this.dragNdrop3.position.y,this.dragNdrop3.position.z))<10?this.activeObj=3:this.activeObj=null:null==i&&(this.distance(new THREE.Vector3(e,this.dragNdrop0.position.y,o),new THREE.Vector3(this.dragNdrop0.position.x,this.dragNdrop0.position.y,this.dragNdrop0.position.z))<10?this.activeObj=0:this.distance(new THREE.Vector3(e,this.dragNdrop1.position.y,o),new THREE.Vector3(this.dragNdrop1.position.x,this.dragNdrop1.position.y,this.dragNdrop1.position.z))<10?this.activeObj=1:this.distance(new THREE.Vector3(e,this.dragNdrop2.position.y,o),new THREE.Vector3(this.dragNdrop2.position.x,this.dragNdrop2.position.y,this.dragNdrop2.position.z))<10?this.activeObj=2:this.distance(new THREE.Vector3(e,this.dragNdrop3.position.y,o),new THREE.Vector3(this.dragNdrop3.position.x,this.dragNdrop3.position.y,this.dragNdrop3.position.z))<10?this.activeObj=3:this.activeObj=null),null==o&&(this.distance(new THREE.Vector3(e,i,this.dragNdrop0.position.z),new THREE.Vector3(this.dragNdrop0.position.x,this.dragNdrop0.position.y,this.dragNdrop0.position.z))<10?this.activeObj=0:this.distance(new THREE.Vector3(e,i,this.dragNdrop1.position.z),new THREE.Vector3(this.dragNdrop1.position.x,this.dragNdrop1.position.y,this.dragNdrop1.position.z))<10?this.activeObj=1:this.distance(new THREE.Vector3(e,i,this.dragNdrop2.position.z),new THREE.Vector3(this.dragNdrop2.position.x,this.dragNdrop2.position.y,this.dragNdrop2.position.z))<10?this.activeObj=2:this.distance(new THREE.Vector3(e,i,this.dragNdrop3.position.z),new THREE.Vector3(this.dragNdrop3.position.x,this.dragNdrop3.position.y,this.dragNdrop3.position.z))<10?this.activeObj=3:this.activeObj=null)},LEVObject.prototype.distance=function(t,e){var i=t.x-e.x,o=t.y-e.y,e=t.z-e.z;return Math.sqrt(i*i+o*o+e*e)},LEVObject.prototype.eventOnMouseMove=function(t,e,i,o){null!=this.activeObj&&(0==this.activeObj?this.setPosition0(e,i,o):1==this.activeObj?this.setPosition1(e,i,o):2==this.activeObj?this.setPosition2(e,i,o):3==this.activeObj&&this.setPosition3(e,i,o))},LEVObject.prototype.render=function(){},LEVObject.prototype.getCenterPosition=function(){return[this.mesh.position.x,this.mesh.position.y,this.mesh.position.z]},LEVObject.prototype.setPosition0=function(t,e,i){null!=t&&(this.point1.x=this.point1.x-this.point0.x+t,this.point2.x=this.point2.x-this.point0.x+t,this.point0.x=t),null!=e&&(this.point1.y=this.point1.y-this.point0.y+e,this.point2.y=this.point2.y-this.point0.y+e,this.point0.y=e),null!=i&&(this.point1.z=this.point1.z-this.point0.z+i,this.point2.z=this.point2.z-this.point0.z+i,this.point0.z=i),this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.z=this.point1.z,this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.z=this.point2.z;i=this.dragNdrop3.position.y-this.dragNdrop0.position.y;this.dragNdrop0.position.x=this.point0.x,this.dragNdrop0.position.y=this.point0.y,this.dragNdrop0.position.z=this.point0.z,this.dragNdrop3.position.x=this.point0.x,this.dragNdrop3.position.y=this.point0.y+i,this.dragNdrop3.position.z=this.point0.z,this.dragNdrop1.position.y=this.point0.y,this.dragNdrop2.position.y=this.point0.y,this.mesh.position.x=this.point0.x,this.mesh.position.y=this.point0.y,this.mesh.position.z=this.point0.z,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.setPosition1=function(t,e,i){null!=t&&(this.point1.x=t),null!=e&&(this.point1.y=e),null!=i&&(this.point1.z=i),this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.z=this.point1.z;var o=Math.sqrt((this.point1.x-this.point0.x)*(this.point1.x-this.point0.x)+(this.point1.z-this.point0.z)*(this.point1.z-this.point0.z)),n=Math.sqrt((this.point2.x-this.point0.x)*(this.point2.x-this.point0.x)+(this.point2.z-this.point0.z)*(this.point2.z-this.point0.z)),t=this.point1.z-this.point0.z,e=-this.point1.x+this.point0.x,i=Math.sqrt(t*t+e*e),t=t/i,e=e/i,i=Math.sqrt(t*t+e*e);console.log(i),this.point2.x=t*n+this.point0.x,this.point2.z=e*n+this.point0.z,console.log(n),this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.z=this.point2.z,this.mesh.scale.x=o,this.mesh.scale.z=n,this.mesh.rotation.y=Math.atan(-(this.point1.z-this.point0.z)/(this.point1.x-this.point0.x)),this.mesh.position.x=this.point0.x,this.mesh.position.y=this.point0.y,this.mesh.position.z=this.point0.z,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.setPosition2=function(t,e,i){null!=t&&(this.point2.x=t),null!=e&&(this.point2.y=e),null!=i&&(this.point2.z=i),this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.z=this.point2.z;var o=Math.sqrt((this.point1.x-this.point0.x)*(this.point1.x-this.point0.x)+(this.point1.z-this.point0.z)*(this.point1.z-this.point0.z)),n=Math.sqrt((this.point2.x-this.point0.x)*(this.point2.x-this.point0.x)+(this.point2.z-this.point0.z)*(this.point2.z-this.point0.z)),t=-this.point2.z+this.point0.z,e=this.point2.x-this.point0.x,i=Math.sqrt(t*t+e*e),t=t/i,i=e/i;this.point1.x=t*o+this.point0.x,this.point1.z=i*o+this.point0.z,this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.z=this.point1.z,this.mesh.scale.x=o,this.mesh.scale.z=n,this.mesh.rotation.y=Math.atan(-(this.point1.z-this.point0.z)/(this.point1.x-this.point0.x)),this.mesh.position.x=this.point0.x,this.mesh.position.y=this.point0.y,this.mesh.position.z=this.point0.z,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.setPosition3=function(t,e,i){this.point3.x=t,this.point3.y=e,this.point3.z=i,this.dragNdrop3.position.y=e;e=this.point3.y-this.point0.y;this.mesh.scale.y=e,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.storeValues=function(t,e,i){null===t&&((t=new Trial).type=this.objConfig.type,t.id=i,e.trials[e.trials.length]=t);e=new SpatialLEVRating;e.name=this.objConfig.name,e.stimulus=this.objConfig.stimulus,e.position_center=[],e.position_width1=[],e.position_width2=[],e.position_height=[],e.position_center[0]=this.point0.x,e.position_center[1]=this.point0.y,e.position_center[2]=this.point0.z,e.position_width1[0]=this.point1.x,e.position_width1[1]=this.point1.y,e.position_width1[2]=this.point1.z,e.position_width2[0]=this.point2.x,e.position_width2[1]=this.point2.y,e.position_width2[2]=this.point2.z,e.position_height[0]=this.point3.x,e.position_height[1]=this.point3.y,e.position_height[2]=this.point3.z,t.responses[t.responses.length]=e},LocalizationObject.prototype.init=function(t){t.add(this.mesh)},LocalizationObject.prototype.eventOnMouseUp=function(t,e,i,o){},LocalizationObject.prototype.eventOnMouseDown=function(t,e,i,o){null!=e&&(this.mesh.position.x=e),null!=i&&(this.mesh.position.y=i),null!=o&&(this.mesh.position.z=o)},LocalizationObject.prototype.render=function(){},LocalizationObject.prototype.getCenterPosition=function(){return[this.mesh.position.x,this.mesh.position.y,this.mesh.position.z]},LocalizationObject.prototype.storeValues=function(t,e,i){null===t&&((t=new Trial).type=this.objConfig.type,t.id=i,e.trials[e.trials.length]=t);e=new SpatialLocalizationRating;e.name=this.objConfig.name,e.stimulus=this.objConfig.stimulus,e.position=[],e.position[0]=this.mesh.position.x,e.position[1]=this.mesh.position.y,e.position[2]=this.mesh.position.z,t.responses[t.responses.length]=e},SpatialObject.prototype.getName=function(){return"template"},SpatialObject.prototype.init=function(){},SpatialObject.prototype.eventOnMouseUp=function(t){},SpatialObject.prototype.eventOnMouseDown=function(t){},SpatialObject.prototype.render=function(){},SpatialObject.prototype.storeValues=function(t,e,i){},Scene.prototype.transformRelativeCoordinates=function(t,e,i,o,n){var s,a,r,l,h,p=[null,null,null];return 1==this.wmCamera.type?"front"==this.viewConfig.view?(p[1]=-e+this.divHeight/2,p[0]=t):"back"==this.viewConfig.view?(p[1]=-e+this.divHeight/2,p[0]=-t):"top"==this.viewConfig.view?(p[0]=t,p[2]=e):"right"==this.viewConfig.view?(p[1]=-e+this.divHeight/2,p[2]=-t):"left"==this.viewConfig.view&&(p[1]=-e+this.divHeight/2,p[2]=t):(s=new THREE.Vector3(-this.wmCamera.getCameraX(),-this.wmCamera.getCameraY(),-this.wmCamera.getCameraZ()),(a=new THREE.Vector3).copy(s),a.normalize(),(h=new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,-1),new THREE.Vector3(a.x,0,a.z).normalize()),r=new THREE.Vector3,(r=new THREE.Vector3(0,0,-1)).applyQuaternion(h),(l=new THREE.Quaternion).setFromUnitVectors(r,a),o=a.dot(new THREE.Vector3(i,o,n)),n=s.length()*Math.tan(22.5*Math.PI/180)/(this.divHeight/2),h=(h=new THREE.Vector3(t*n,-e*n,0).applyQuaternion(h)).applyQuaternion(l),l=new THREE.Vector3(h.x,h.y,h.z),(h=new THREE.Vector3).addVectors(s,l),h.normalize(),h.multiplyScalar(Math.sqrt(Math.pow(s.length()+o,2)+Math.pow(l.length()*(s.length()+o)/s.length(),2))),h.addVectors(h,s.negate()),p[0]=h.x,p[1]=h.y,p[2]=h.z),p},Scene.prototype.load=function(){new DOMParser;this.setAmbientLight(15658734),this.setDirectionalLight(),this.scene.add(this.camera),this.buildRectangularElement()},Scene.prototype.render=function(){this.renderer.render(this.scene,this.camera)},Scene.prototype.buildRectangularElement=function(){this.width=this.pageConfig.roomMeasurements[0],this.height=this.pageConfig.roomMeasurements[1],this.depth=this.pageConfig.roomMeasurements[2];var t=THREE.ImageUtils.loadTexture("res/spatial/carpet.png");t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.x=8,t.repeat.y=8,this.materialFloor=new THREE.MeshBasicMaterial({map:t}),this.floor=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.depth),this.materialFloor);var e=new THREE.ImageUtils.loadTexture("res/spatial/ceiling.png");e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.x=8,e.repeat.y=8;t=new THREE.ImageUtils.loadTexture("res/spatial/wall.png");t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.x=4,t.repeat.y=2,this.materialWall=new THREE.MeshLambertMaterial({map:t}),this.materialCeiling=new THREE.MeshLambertMaterial({map:e}),this.wall=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.height,10,10),this.materialWall),this.materialWallLeft=new THREE.MeshLambertMaterial({map:t}),this.wallfront=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.height,10,10),this.materialWall),this.materialWallLeft=new THREE.MeshLambertMaterial({map:t}),this.wallLeft=new THREE.Mesh(new THREE.PlaneGeometry(this.depth,this.height,10,10),this.materialWallLeft),this.materialWallRight=new THREE.MeshLambertMaterial({map:t}),this.wallRight=new THREE.Mesh(new THREE.PlaneGeometry(this.depth,this.height,10,10),this.materialWallRight),this.ceiling=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.depth,10,10),this.materialCeiling),this.material=new THREE.MeshBasicMaterial({map:e,wireframe:!0,opacity:.3}),this.floor.rotation.x=-Math.PI/2,this.wallLeft.position.x=-this.width/2,this.wallLeft.rotation.y=Math.PI/2,this.wallLeft.position.y=this.height/2,this.wallRight.position.x=this.width/2,this.wallRight.rotation.y=-Math.PI/2,this.wallRight.position.y=this.height/2,this.wall.position.z=-this.depth/2,this.wall.position.y=this.height/2,this.wallfront.position.z=this.depth/2,this.wallfront.position.y=this.height/2,this.wallfront.rotation.y=Math.PI,this.ceiling.position.y=this.height/2,this.ceiling.rotation.x=Math.PI/2,this.ceiling.position.y=this.height,this.scene.add(this.ceiling),this.scene.add(this.wallRight),this.scene.add(this.wallLeft),this.scene.add(this.wall),this.scene.add(this.wallfront),this.scene.add(this.floor)},Scene.prototype.getHeight=function(){return this.height},Scene.prototype.getWidth=function(){return this.width},Scene.prototype.getDepth=function(){return this.depth},Scene.prototype.addListener=function(_configListener){var x=_configListener.position[0],y0=0,y=_configListener.position[1],z=_configListener.position[2],rotx=2*(_configListener.rotation[0]+180)*Math.PI/360,roty=2*_configListener.rotation[1]*Math.PI/360,rotz=2*_configListener.rotation[2]*Math.PI/360,loader=new THREE.ColladaLoader,str="var tempScene = this.scene; loader.load('res/spatial/listener_head.dae', function(collada) {";str+="collada.scene.scale.x = collada.scene.scale.y = collada.scene.scale.z = 10;",str+="collada.scene.rotation.x =-Math.PI / 2 + "+rotx+";",str+="collada.scene.rotation.y = "+roty+" - Math.PI;",str+="collada.scene.rotation.z = Math.PI + "+rotz+";",str+="collada.scene.position.x = "+x+";",str+="collada.scene.position.y = "+y+";",str+="collada.scene.position.z = "+z+";",str+="tempScene.add(collada.scene)",str+="});",eval(str)},Scene.prototype.addCustomObject=function(t){var e=new THREE.ColladaLoader,i=t.path,t={config:t,scene:this.scene};e.load(i,function(t){var e=this.config.position[0],i=this.config.position[1],o=this.config.position[2],n=2*this.config.rotation[0]*Math.PI/360,s=2*this.config.rotation[1]*Math.PI/360,a=2*this.config.rotation[2]*Math.PI/360;t.scene.scale.x=t.scene.scale.y=t.scene.scale.z=this.config.scale,t.scene.position.x=e,t.scene.position.y=i,t.scene.position.z=o,t.scene.rotation.x=-Math.PI/2+n,t.scene.rotation.y=s,t.scene.rotation.z=a,this.scene.add(t.scene)}.bind(t))},Scene.prototype.setDirectionalLight=function(){var t=new THREE.DirectionalLight(10066329);t.position.set(0,100,0),t.target.position.set(0,0,0),t.castShadow=!0,t.shadowDarkness=.2,t.shadowCameraVisible=!0,this.scene.add(t);t=new THREE.DirectionalLight(6710886);t.position.set(100,0,0),t.target.position.set(0,0,0),t.castShadow=!0,t.shadowDarkness=.2,t.shadowCameraVisible=!0,this.scene.add(t);t=new THREE.DirectionalLight(6710886);t.position.set(-100,0,0),t.target.position.set(0,0,0),t.castShadow=!0,t.shadowDarkness=.2,t.shadowCameraVisible=!0,this.scene.add(t);t=new THREE.DirectionalLight(6710886);t.position.set(0,0,100),t.target.position.set(0,0,0),t.castShadow=!0,t.shadowDarkness=.2,t.shadowCameraVisible=!0,this.scene.add(t);t=new THREE.DirectionalLight(6710886);t.position.set(0,0,-100),t.target.position.set(0,0,0),t.castShadow=!0,t.shadowDarkness=.2,t.shadowCameraVisible=!0,this.scene.add(t)},Scene.prototype.setAmbientLight=function(t){this.ambient=new THREE.AmbientLight(t),this.scene.add(this.ambient)},Scene.prototype.setGridWall=function(t){1==t?this.wall.material=this.material:0==t&&(this.wall.material=this.materialWall)},Scene.prototype.setGridWallLeft=function(t){1==t?this.wallLeft.material=this.material:0==t&&(this.wallLeft.material=this.materialWallLeft)},Scene.prototype.setGridWallRight=function(t){1==t?this.wallRight.material=this.material:0==t&&(this.wallRight.material=this.materialWallRight)},Scene.prototype.setGridFloor=function(t){1==t?this.floor.material=this.material:0==t&&(this.floor.material=this.materialFloor)},Scene.prototype.setGridCeiling=function(t){1==t?this.ceiling.material=this.material:0==t&&(this.ceiling.material=this.materialCeiling)},Scene.prototype.setColorLeftWall=function(t){this.wallLeft.material.color.setHex(t)},Scene.prototype.getColorWall=function(){return this.wall.material.color.getHex()},Scene.prototype.setColorWall=function(t){this.wall.material.color.setHex(t)};